<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
<title>7. Kernel | OpenCore 简体中文参考手册(非官方)</title>
<meta name="generator" content="Hexo 4.2.0">
<meta http-equiv="x-dns-prefetch-control" content="on">
<meta name="description" content="由 Sukka 和黑苹果爱好者们维护的 OpenCore 文档简体中文翻译，实时更新 OpenCore 上游文档改动。努力提供权威的 OpenCore 简体中文参考资料。">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/logo/favicon.ico">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.16.2/styles/github.min.css">
<link rel="stylesheet" href="/theme-doku/css/doku.css">
<link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml">

</head>

<body>
    

<nav id="doku-navbar" class="navbar is-spaced has-shadow">
    <div class="container">
        <div class="navbar-brand">
            <!-- burger btn -->
            <a role="button" class="navbar-burger burger" id="doku-sidebar-toggle">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>

            <a class="navbar-item" href="https://oc.skk.moe">
                <h1 class="doku-navbar-title">
                    <img src="/logo/navbar.png" height="28">
                    <span class="is-size-4"></span>
                </h1>
            </a>
        </div>
        <div class="navbar-menu">
            <div class="navbar-start">
                
                    <a class="navbar-item" href="/">
                        
                        
                            <span>OpenCore 参考手册(简体中文)</span>
                        
                    </a>
                
                    <a class="navbar-item" href="/search.html">
                        
                            <span class="icon">
                                <i class="fas fa-search"></i>
                            </span>
                        
                        
                            <span>站内搜索</span>
                        
                    </a>
                
                    <a class="navbar-item" href="https://github.com/SukkaW/OpenCore-Document-zh_Hans" target="_blank" rel="noopener">
                        
                            <span class="icon">
                                <i class="fab fa-github"></i>
                            </span>
                        
                        
                            <span>GitHub</span>
                        
                    </a>
                
                <!-- navbar link -->
                <!--<a class="navbar-item">
                Home
            </a>-->
            </div>
            <!-- i18n switch -->
            <div class="navbar-end">
                <!--<div class="navbar-item">
                    <div class="dropdown is-right is-hoverable">
                        <div class="dropdown-trigger">
                            <button class="button" id="navbar-i18n-btn">
                                <span class="icon is-small">
                                    <i class="fas fa-globe-americas" aria-hidden="true"></i>
                                </span>
                                <span>Language</span>
                                <span class="icon is-small">
                                    <i class="fas fa-angle-down" aria-hidden="true"></i>
                                </span>
                            </button>
                        </div>
                        <div class="dropdown-menu">
                            <div class="dropdown-content">
                                <a href="#" class="dropdown-item">
                                    Dropdown item
                                </a>
                                <a class="dropdown-item">
                                    Other dropdown item
                                </a>
                                <a href="#" class="dropdown-item">
                                    Active dropdown item
                                </a>
                                <a href="#" class="dropdown-item">
                                    Other dropdown item
                                </a>
                            </div>
                        </div>
                    </div>
                </div>-->
            </div>
        </div>
    </div>
</nav>


    <div class="container-fluid">
        <section class="main-content">
            


<aside class="doku-sidebar" id="doku-sidebar">
    <div class="doku-sidebar-content">
        <div class="menu">
            
                <ul class="menu-list is-hidden-desktop">
                    
                        
                            <li><a href="/">OpenCore 参考手册(简体中文)</span></a></li>
                        
                    
                        
                            <li><a href="/search.html">站内搜索</span></a></li>
                        
                    
                        
                            <li><a href="https://github.com/SukkaW/OpenCore-Document-zh_Hans" target="_blank" rel="noopener">GitHub</span></a></li>
                        
                    
                </ul>
            
            <hr class="is-hidden-desktop">
            
                
                    <ul class="menu-list">
                        
                            <li><a  href="/">0. 首页</a></li>
                        
                            <li><a  href="/1-introduction.html">1. 简介</a></li>
                        
                            <li><a  href="/2-configuration.html">2. 配置</a></li>
                        
                            <li><a  href="/3-setup.html">3. Setup</a></li>
                        
                            <li><a  href="/4-acpi.html">4. ACPI</a></li>
                        
                            <li><a  href="/5-booter.html">5. Booter</a></li>
                        
                            <li><a  href="/6-device-properties.html">6. DeviceProperties</a></li>
                        
                            <li><a class="is-current" href="/7-kernel.html">7. Kernel</a></li>
                        
                            <li><a  href="/8-misc.html">8. Misc</a></li>
                        
                            <li><a  href="/9-nvram.html">9. NVRAM</a></li>
                        
                            <li><a  href="/10-platform-info.html">10. PlatformInfo</a></li>
                        
                            <li><a  href="/11-uefi.html">11. UEFI</a></li>
                        
                            <li><a  href="/12-troubleshooting.html">12. 排错</a></li>
                        
                            <li><a  href="/kextlist.html">附录 1. OpenCore 兼容 Kext 列表</a></li>
                        
                    </ul>
                
            
        </div>
    </div>
</aside>

            <main class="is-paddingless doku-main-wrapper" id="doku-main">
                

<article class="doku-document-container clearfix">
    <header class="hero is-light" id="doku-document-hero">
        <div class="hero-body">
            <h1 class="title">7. Kernel</h1>
            
                <p class="subtitle">OpenCore 安全配置，Kext 加载顺序以及屏蔽（待翻译）</p>
            
            
                
                    <p><small>由 Sukka 整理，由 Sukka 翻译。</small></p>
                
                
                    <p><small>本页面最后更新于 2020 年 02 月 20 日</small></p>
                
                <br>
            
            
                <a href="https://github.com/sukkaw/OpenCore-Document-zh_Hans/tree/master/source/7-kernel.md" target="_blank" rel="external nofollow noreferrer noopener" class="button is-small is-rounded is-black"><span class="icon is-small"><i class="fab fa-github"></i></span><span>在 GitHub 上编辑</span></a>
            
        </div>
    </header>
    <div class="columns">
        <div class="column is-9-tablet doku-document-wrapper">
            <div class="content">
                <h2 id="7-1-简介"><a href="#7-1-简介" class="headerlink" title="7.1 简介"></a>7.1 简介</h2><p>This section allows to apply different kinds of kernelspace modifications on Apple Kernel (<a href="https://opensource.apple.com/source/xnu" target="_blank" rel="noopener">XNU</a>). The modifications currently provide driver (kext) injection, kernel and driver patching, and driver blocking.</p>
<h2 id="7-2-属性列表"><a href="#7-2-属性列表" class="headerlink" title="7.2 属性列表"></a>7.2 属性列表</h2><h3 id="7-2-1-Add"><a href="#7-2-1-Add" class="headerlink" title="7.2.1 Add"></a>7.2.1 Add</h3><p><strong>Type</strong>: plist array<br><strong>Failsafe</strong>: Empty<br><strong>Description</strong>: 从 <code>OC/Kexts</code> 目录加载选定的 Kext 驱动。</p>
<p>设计为使用 plist dict 数据填充以描述每个驱动程序。请参阅下述 Add 属性章节。Kext 驱动程序加载的顺序遵照数组中项目的顺序，因此如 Lilu 这种其他驱动程序的依赖驱动应该位于前面。</p>
<h3 id="7-2-2-Block"><a href="#7-2-2-Block" class="headerlink" title="7.2.2 Block"></a>7.2.2 Block</h3><p><strong>Type</strong>: plist array<br><strong>Failsafe</strong>: Empty<br><strong>Description</strong>: 从内核中删除选定的内核驱动程序。</p>
<p>设计为使用 plist dict 数据填充以描述每个驱动程序。请参阅下述 Block 属性章节。Kext 驱动程序加载的顺序遵照数组中项目的顺序，因此如 Lilu 这种其他驱动程序的依赖驱动应该位于前面。</p>
<h3 id="7-2-3-Emulate"><a href="#7-2-3-Emulate" class="headerlink" title="7.2.3 Emulate"></a>7.2.3 Emulate</h3><p><strong>Type</strong>: plist dict<br><strong>Description</strong>: 在内核空间中仿真选定的硬件。请参考下文 Emulate 属性。</p>
<h3 id="7-2-4-Patch"><a href="#7-2-4-Patch" class="headerlink" title="7.2.4 Patch"></a>7.2.4 Patch</h3><p><strong>Type</strong>: plist array<br><strong>Failsafe</strong>: Empty<br><strong>Description</strong>: 在添加和删除驱动程序步骤之前执行的对现有 Kext 驱动程序的二进制修补。</p>
<p>设计为使用 plist dictionary 数据填充以描述每个驱动程序。请参阅下述 Patch 属性章节。</p>
<h3 id="7-2-5-Quirks"><a href="#7-2-5-Quirks" class="headerlink" title="7.2.5 Quirks"></a>7.2.5 Quirks</h3><p><strong>Type</strong>: plist dict<br><strong>Description</strong>: 应用下面的 Quirks 属性章节中描述的各个内核和驱动程序 Quirk。</p>
<h2 id="7-3-Add-属性"><a href="#7-3-Add-属性" class="headerlink" title="7.3 Add 属性"></a>7.3 Add 属性</h2><h3 id="7-3-1-BundlePath"><a href="#7-3-1-BundlePath" class="headerlink" title="7.3.1 BundlePath"></a>7.3.1 <code>BundlePath</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Kext 相对于 <code>EFI/OC/kexts/Other/</code> 的路径 (e.g. <code>Lilu.kext</code> or <code>MyKext.kext/Contents/PlugIns/MySubKext.kext</code>).</p>
<blockquote>
<p>注，如 <code>VoodooPS2Controller.kext</code> 这种包括其他 kext 驱动的，需要分别单独添加，如 <code>VoodooPS2Controller.kext/Contents/PlugIns/VoodooPS2Keyboard.kext</code>。</p>
</blockquote>
<h3 id="7-3-2-Comment"><a href="#7-3-2-Comment" class="headerlink" title="7.3.2 Comment"></a>7.3.2 <code>Comment</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: 用于为条目提供人类可读参考的任意 ASCII 字符串（译者注：即注释）。</p>
<h3 id="7-3-3-Enabled"><a href="#7-3-3-Enabled" class="headerlink" title="7.3.3 Enabled"></a>7.3.3 <code>Enabled</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: 是否加载该驱动.</p>
<h3 id="7-3-4-ExecutablePath"><a href="#7-3-4-ExecutablePath" class="headerlink" title="7.3.4 ExecutablePath"></a>7.3.4 <code>ExecutablePath</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Kext 中实际可执行文件的路径（如 <code>Lilu.kext</code> 中的可执行文件路径是 <code>Contents/MacOS/Lilu</code>）。</p>
<blockquote>
<p>译者注：空壳 Kext 没有可执行文件（如 <code>USBPorts.kext</code>），此项留空即可</p>
</blockquote>
<h3 id="7-3-5-MaxKernel"><a href="#7-3-5-MaxKernel" class="headerlink" title="7.3.5 MaxKernel"></a>7.3.5 <code>MaxKernel</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: 在小于等于指定的 macOS 版本中添加该 Kext 驱动程序。</p>
<p>你可以使用 <code>uname -r</code> 指令获取当前内核版本，一般为三个整数、中间由半角局点分隔，如 <code>18.7.0</code> 代表的是 <code>10.14.6</code>。OpenCore 对内核版本解释的实现方式如下图所示：</p>
<p><img src="/img/7-1.png" alt="7-1.png"></p>
<p>内核版本比较的实现如下图所示：</p>
<p><img src="/img/7-2.png" alt="7-2.png"></p>
<p>将 Darwin 内核版本号字符串从左到右以 <code>.</code> 符号作为分隔符分割成三个整数，即为 <code>ParseDarwinVersion</code> 的三个参数。<code>FindDarwinVersion</code> 函数将会通过在内核镜像中查找形如 <img src="/img/7-3.png" alt=""> 的字符串来定位 Darwin 内核版本号。</p>
<h3 id="7-3-6-MinKernel"><a href="#7-3-6-MinKernel" class="headerlink" title="7.3.6 MinKernel"></a>7.3.6 <code>MinKernel</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: 在大于等于指定的 macOS 版本中添加该 Kext 驱动程序。</p>
<p><em>注</em>：Refer to <a href="#kernmatch"><code>Add</code> <code>MaxKernel</code> description</a> for<br>matching logic.</p>
<blockquote>
<p>译者注：以上两个属性定义了这个驱动将在什么版本范围的 macOS 中加载。留空表示在所有的 macOS 版本下都加载。</p>
</blockquote>
<h3 id="7-3-7-PlistPath"><a href="#7-3-7-PlistPath" class="headerlink" title="7.3.7 PlistPath"></a>7.3.7 <code>PlistPath</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Kext 中 <code>Info.plist</code> 文件的路径。一般为 <code>Contents/Info.plist</code>。</p>
<h2 id="7-4-Block-属性"><a href="#7-4-Block-属性" class="headerlink" title="7.4 Block 属性"></a>7.4 Block 属性</h2><h3 id="7-4-1-Comment"><a href="#7-4-1-Comment" class="headerlink" title="7.4.1 Comment"></a>7.4.1 <code>Comment</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: 用于为条目提供人类可读参考的任意 ASCII 字符串（译者注：即注释）。</p>
<h3 id="7-4-2-Enabled"><a href="#7-4-2-Enabled" class="headerlink" title="7.4.2 Enabled"></a>7.4.2 <code>Enabled</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: This kernel driver will not be blocked unless set to <code>true</code>.</p>
<h3 id="7-4-3-Identifier"><a href="#7-4-3-Identifier" class="headerlink" title="7.4.3 Identifier"></a>7.4.3 <code>Identifier</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Kext bundle identifier (e.g.<br><code>com.apple.driver.AppleTyMCEDriver</code>).</p>
<h3 id="7-4-4-MaxKernel"><a href="#7-4-4-MaxKernel" class="headerlink" title="7.4.4 MaxKernel"></a>7.4.4 <code>MaxKernel</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: 在小于等于指定的 macOS 版本中阻止 Kext 驱动程序。</p>
<p><em>注</em>：Refer to <a href="#kernmatch"><code>Add</code> <code>MaxKernel</code> description</a> for matching logic.</p>
<h3 id="7-4-5-MinKernel"><a href="#7-4-5-MinKernel" class="headerlink" title="7.4.5 MinKernel"></a>7.4.5 <code>MinKernel</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: 在大于等于指定的 macOS 版本中阻止 Kext 驱动程序。</p>
<p><em>注</em>：Refer to <a href="#kernmatch"><code>Add</code> <code>MaxKernel</code> description</a> for<br>matching logic.</p>
<h2 id="7-5-Emulate-属性"><a href="#7-5-Emulate-属性" class="headerlink" title="7.5 Emulate 属性"></a>7.5 Emulate 属性</h2><h3 id="7-5-1-Cpuid1Data"><a href="#7-5-1-Cpuid1Data" class="headerlink" title="7.5.1 Cpuid1Data"></a>7.5.1 <code>Cpuid1Data</code></h3><p><strong>Type</strong>: <code>plist data</code>, 16 bytes<br><strong>Failsafe</strong>: All zero<br><strong>Description</strong>: Sequence of <code>EAX</code>, <code>EBX</code>, <code>ECX</code>, <code>EDX</code> values to replace <code>CPUID (1)</code> call in XNU kernel.</p>
<p>This property serves for two needs:</p>
<ul>
<li>Enabling support of an unsupported CPU model.</li>
<li>Enabling XCPM support for an unsupported CPU variant.</li>
</ul>
<p>Normally it is only the value of <code>EAX</code> that needs to be taken care of, since it represents the full CPUID. The remaining bytes are to be left as zeroes. Byte order is Little Endian, so for example, <code>A9 06 03 00</code> stands for CPUID <code>0x0306A9</code> (Ivy Bridge).</p>
<p>For XCPM support it is recommended to use the following combinations.</p>
<ul>
<li><p>Haswell-E (<code>0x306F2</code>) to Haswell (<code>0x0306C3</code>):</p>
<p><code>Cpuid1Data</code>: <code>C3 06 03 00 00 00 00 00 00 00 00 00 00 00 00 00</code><br><code>Cpuid1Mask</code>: <code>FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00</code></p>
</li>
<li><p>Broadwell-E (<code>0x0406F1</code>) to Broadwell (<code>0x0306D4</code>):<br><code>Cpuid1Data</code>: <code>D4 06 03 00 00 00 00 00 00 00 00 00 00 00 00 00</code><br><code>Cpuid1Mask</code>: <code>FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00</code></p>
</li>
</ul>
<p>Further explanations can be found at <a href="https://github.com/acidanthera/bugtracker/issues/365" target="_blank" rel="noopener">acidanthera/bugtracker#365</a>. See <code>Special NOTES</code> for Haswell+ low-end.</p>
<h3 id="7-5-2-Cpuid1Mask"><a href="#7-5-2-Cpuid1Mask" class="headerlink" title="7.5.2 Cpuid1Mask"></a>7.5.2 <code>Cpuid1Mask</code></h3><p><strong>Type</strong>: <code>plist data</code>, 16 bytes<br><strong>Failsafe</strong>: All zero<br><strong>Description</strong>: Bit mask of active bits in <code>Cpuid1Data</code>.</p>
<p>When each <code>Cpuid1Mask</code> bit is set to 0, the original CPU bit is used,<br>otherwise set bits take the value of <code>Cpuid1Data</code>.</p>
<h2 id="7-6-Patch-属性"><a href="#7-6-Patch-属性" class="headerlink" title="7.6 Patch 属性"></a>7.6 Patch 属性</h2><h3 id="7-6-1-Base"><a href="#7-6-1-Base" class="headerlink" title="7.6.1 Base"></a>7.6.1 <code>Base</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Selects symbol-matched base for patch lookup (or immediate replacement) by obtaining the address of provided symbol name. Can be set to empty string to be ignored.</p>
<h3 id="7-6-2-Comment"><a href="#7-6-2-Comment" class="headerlink" title="7.6.2 Comment"></a>7.6.2 <code>Comment</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: 用于为条目提供人类可读参考的任意 ASCII 字符串（译者注：即注释）。</p>
<h3 id="7-6-3-Count"><a href="#7-6-3-Count" class="headerlink" title="7.6.3 Count"></a>7.6.3 <code>Count</code></h3><p><strong>Type</strong>: <code>plist integer</code><br><strong>Failsafe</strong>: <code>0</code><br><strong>Description</strong>: Number of patch occurrences to apply. <code>0</code> applies the patch to all occurrences found.</p>
<h3 id="7-6-4-Enabled"><a href="#7-6-4-Enabled" class="headerlink" title="7.6.4 Enabled"></a>7.6.4 <code>Enabled</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: This kernel patch will not be used unless set to <code>true</code>.</p>
<h3 id="7-6-5-Find"><a href="#7-6-5-Find" class="headerlink" title="7.6.5 Find"></a>7.6.5 <code>Find</code></h3><p><strong>Type</strong>: <code>plist data</code><br><strong>Failsafe</strong>: Empty data<br><strong>Description</strong>: Data to find. Can be set to empty for immediate replacement at <code>Base</code>. Must equal to <code>Replace</code> in size otherwise.</p>
<h3 id="7-6-6-Identifier"><a href="#7-6-6-Identifier" class="headerlink" title="7.6.6 Identifier"></a>7.6.6 <code>Identifier</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Kext bundle identifier (e.g.<br><code>com.apple.driver.AppleHDA</code>) or <code>kernel</code> for kernel patch.</p>
<h3 id="7-6-7-Limit"><a href="#7-6-7-Limit" class="headerlink" title="7.6.7 Limit"></a>7.6.7 <code>Limit</code></h3><p><strong>Type</strong>: <code>plist integer</code><br><strong>Failsafe</strong>: <code>0</code><br><strong>Description</strong>: Maximum number of bytes to search for. Can be set to <code>0</code> to look through the whole kext or kernel.</p>
<h3 id="7-6-8-Mask"><a href="#7-6-8-Mask" class="headerlink" title="7.6.8 Mask"></a>7.6.8 <code>Mask</code></h3><p><strong>Type</strong>: <code>plist data</code><br><strong>Failsafe</strong>: Empty data<br><strong>Description</strong>: Data bitwise mask used during find comparison. Allows fuzzy search by ignoring not masked (set to zero) bits. Can be set to empty data to be ignored. Must equal to <code>Replace</code> in size otherwise.</p>
<h3 id="7-6-9-MaxKernel"><a href="#7-6-9-MaxKernel" class="headerlink" title="7.6.9 MaxKernel"></a>7.6.9 <code>MaxKernel</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Patches data on specified macOS version or older.</p>
<p><em>注</em>：Refer to <a href="#kernmatch"><code>Add</code> <code>MaxKernel</code> description</a> for matching logic.</p>
<h3 id="7-6-10-MinKernel"><a href="#7-6-10-MinKernel" class="headerlink" title="7.6.10 MinKernel"></a>7.6.10 <code>MinKernel</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Patches data on specified macOS version or newer.</p>
<p><em>注</em>：Refer to <a href="#kernmatch"><code>Add</code> <code>MaxKernel</code> description</a> for matching logic.</p>
<h3 id="7-6-11-Replace"><a href="#7-6-11-Replace" class="headerlink" title="7.6.11 Replace"></a>7.6.11 <code>Replace</code></h3><p><strong>Type</strong>: <code>plist data</code><br><strong>Failsafe</strong>: Empty data<br><strong>Description</strong>: Replacement data of one or more bytes.</p>
<h3 id="7-6-12-ReplaceMask"><a href="#7-6-12-ReplaceMask" class="headerlink" title="7.6.12 ReplaceMask"></a>7.6.12 <code>ReplaceMask</code></h3><p><strong>Type</strong>: <code>plist data</code><br><strong>Failsafe</strong>: Empty data<br><strong>Description</strong>: Data bitwise mask used during replacement. Allows fuzzy replacement by updating masked (set to non-zero) bits. Can be set to empty data to be ignored. Must equal to <code>Replace</code> in size otherwise.</p>
<h3 id="7-6-13-Skip"><a href="#7-6-13-Skip" class="headerlink" title="7.6.13 Skip"></a>7.6.13 <code>Skip</code></h3><p><strong>Type</strong>: <code>plist integer</code><br><strong>Failsafe</strong>: <code>0</code><br><strong>Description</strong>: Number of found occurrences to be skipped before replacement is done.</p>
<h2 id="7-7-Quirks-属性"><a href="#7-7-Quirks-属性" class="headerlink" title="7.7 Quirks 属性"></a>7.7 Quirks 属性</h2><h3 id="AppleCpuPmCfgLock"><a href="#AppleCpuPmCfgLock" class="headerlink" title="AppleCpuPmCfgLock"></a><code>AppleCpuPmCfgLock</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: 禁用 <code>AppleIntelCPUPowerManagement.kext</code> 中的 <code>PKG_CST_CONFIG_CONTROL</code> (<code>0xE2</code>) 修改，从而避免早期 Kernel Panic。</p>
<p>某些固件会锁定 <code>PKG_CST_CONFIG_CONTROL</code> MSR 寄存器。可以使用捆绑的 <code>VerifyMsrE2</code> 工具检查其状态。</p>
<p>由于现代固件已经提供了 <code>CFG Lock</code> 相关设置、从而可以配置 <code>PKG_CST_CONFIG_CONTROL</code> 寄存器锁定，此选项应该尽可能避免。对于一些不显示 <code>CFG Lock</code> 配置的固件，可以按照下述配置进行修改：</p>
<ol>
<li>下载 <a href="https://github.com/LongSoft/UEFITool/releases" target="_blank" rel="noopener">UEFITool</a> 和 <a href="https://github.com/LongSoft/Universal-IFR-Extractor/releases" target="_blank" rel="noopener">IFR-Extractor</a></li>
<li>使用 UEFITool 中打开固件镜像文件，找到 CFG Lock 的 Unicode 字符串。如果你没有找到，意味着你的固件可能不支持 CFG Lock 解锁，那么你现在可以停下来了。</li>
<li>从 UEFITool 菜单中的 <code>Extract Body</code> 选项提取 <code>Setup.bin</code> 中的 PE32 镜像部分。</li>
<li>对提取出来的文件执行 IFR-Extractor（<code>./ifrextract Setup.bin Setup.txt</code>）。</li>
<li>从 Setup.txt 中找到 CFG Lock，VarStoreInfo（或者 VarOffset、VarName），记住紧随其后的偏移量值（例如 <code>0x123</code>）。</li>
<li>下载并执行由 <a href="https://geektimes.com/post/258090" target="_blank" rel="noopener">brainsucker</a> 编译的 <a href="http://brains.by/posts/bootx64.7z" target="_blank" rel="noopener">修改版 GRUB Shell</a>。你也可以是使用 <a href="https://github.com/datasone" target="_blank" rel="noopener">datasone</a> 制作的 <a href="https://github.com/datasone/grub-mod-setup_var" target="_blank" rel="noopener">新版本 GRUB Shell</a>。</li>
<li>在 GRUB Shell 中，使用 <code>setup_var 0x123 0x00</code>（其中 <code>0x123</code> 应该被替换为你在前几步找到的偏移值），然后重启电脑。</li>
</ol>
<p><strong>警告</strong>: 可变偏移量对于每个主板乃至每一个固件版本都是唯一的。永远不要尝试使用别人的偏移量！</p>
<h3 id="AppleXcpmCfgLock"><a href="#AppleXcpmCfgLock" class="headerlink" title="AppleXcpmCfgLock"></a><code>AppleXcpmCfgLock</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: 禁用 XNU 内核对 <code>PKG_CST_CONFIG_CONTROL</code> (<code>0xE2</code>) 修改，从而避免早期 Kernel Panic。</p>
<p><em>注</em>：这一选项应该避免被使用，请参考上文中关于 <code>AppleCpuPmCfgLock</code> 的介绍。</p>
<h3 id="AppleXcpmExtraMsrs"><a href="#AppleXcpmExtraMsrs" class="headerlink" title="AppleXcpmExtraMsrs"></a><code>AppleXcpmExtraMsrs</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: 对于没有 XCMP 支持的设备，禁用对选定 CPU 的多 MSR 访问。</p>
<p>通常将其与 Haswell-E，Broadwell-E，Skylake-X和类似 CPU 的 <code>Emulate</code> 结合使用。更多关于 XCPM 修补的信息可以在 <a href="https://github.com/acidanthera/bugtracker/issues/365" target="_blank" rel="noopener">acidanthera/bugtracker#365</a> 找到。</p>
<p><em>注</em>：Ivy Bridge 或 Pentium CPU 将需要其他未提供的补丁。建议对前者使用 <code>AppleIntelCpuPowerManagement.kext</code>。</p>
<h3 id="AppleXcpmForceBoost"><a href="#AppleXcpmForceBoost" class="headerlink" title="AppleXcpmForceBoost"></a><code>AppleXcpmForceBoost</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: 在 XCPM 模式下强制使用最大性能。</p>
<p>This patch writes <code>0xFF00</code> to <code>MSR_IA32_PERF_CONTROL</code> (<code>0x199</code>), effectively setting maximum multiplier for all the time.</p>
<p><em>注</em>：尽管有助于提高性能，但是在所有操作系统上都强烈建议不要启用这一选项。只有在某些 Xeon 型号的 CPU 才有可能从这个选项中受益。</p>
<h3 id="CustomSMBIOSGuid"><a href="#CustomSMBIOSGuid" class="headerlink" title="CustomSMBIOSGuid"></a><code>CustomSMBIOSGuid</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: 对 UpdateSMBIOSMode 自定义模式执行 GUID 修补，通常用于戴尔笔记本电脑。</p>
<h3 id="DisableIoMapper"><a href="#DisableIoMapper" class="headerlink" title="DisableIoMapper"></a><code>DisableIoMapper</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: 禁用 XNU (VT-d) 中的 <code>IOMapper</code> 支持，这可能与固件的实现相冲突。</p>
<p><em>注</em>：相比直接在 ACPI 表中删除 <code>DMAR</code>，我们更推荐大家使用这一选项。这样不会破坏其他操作系统中的 VT-d 支持（总会有人需要用到的，对吧？）。</p>
<h3 id="DummyPowerManagement"><a href="#DummyPowerManagement" class="headerlink" title="DummyPowerManagement"></a><code>DummyPowerManagement</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: 禁用 <code>AppleIntelCpuPowerManagement</code>。</p>
<p><em>注</em>：这一选项旨在替代 <code>NullCpuPowerManagement.kext</code>，用于 macOS 中没有电源管理驱动程序的 CPU。</p>
<h3 id="ExternalDiskIcons"><a href="#ExternalDiskIcons" class="headerlink" title="ExternalDiskIcons"></a><code>ExternalDiskIcons</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: 修补 <code>AppleAHCIPort.kext</code> 图标，使 macOS 将所有 AHCI 存储设备显示为内部硬盘。</p>
<p><em>注</em>：这一选项应尽量避免使用。现代固件通常情况下都是兼容的。</p>
<h3 id="IncreasePciBarSize"><a href="#IncreasePciBarSize" class="headerlink" title="IncreasePciBarSize"></a><code>IncreasePciBarSize</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: 将 IOPCIFamily 中 32 位 PCI Bar 的大小从 1 GB 增加到 4 GB。</p>
<p><em>注</em>：你应该尽可能避免使用这一选项。通常这一选项只需要在配置错误或损坏的固件上开启。</p>
<blockquote>
<p>译者注：如果你的 BIOS 中存在 Above4GDecoding 选项，请直接在 BIOS 中启用。</p>
</blockquote>
<h3 id="LapicKernelPanic"><a href="#LapicKernelPanic" class="headerlink" title="LapicKernelPanic"></a><code>LapicKernelPanic</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: 禁用 LAPIC 中断导致的 Kernal Panic。</p>
<blockquote>
<p>译者注：惠普电脑可能需要启用这一选项。</p>
</blockquote>
<h3 id="PanicNoKextDump"><a href="#PanicNoKextDump" class="headerlink" title="PanicNoKextDump"></a><code>PanicNoKextDump</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: 在发生内核崩溃时阻止输出 Kext 列表，提供可供排错参考的崩溃日志。</p>
<h3 id="PowerTimeoutKernelPanic"><a href="#PowerTimeoutKernelPanic" class="headerlink" title="PowerTimeoutKernelPanic"></a><code>PowerTimeoutKernelPanic</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: 修复 macOS Catalina 中由于设备电源状态变化超时而导致的内核崩溃。</p>
<p>An additional security measure was added to macOS Catalina (10.15) causing kernel panic on power change timeout for Apple drivers. Sometimes it may cause issues on misconfigured hardware, notably digital audio, which sometimes fails to wake up. For debug kernels <code>setpowerstate_panic=0</code> boot argument should be used, which is otherwise equivalent to this quirk.</p>
<h3 id="ThirdPartyDrives"><a href="#ThirdPartyDrives" class="headerlink" title="ThirdPartyDrives"></a><code>ThirdPartyDrives</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: 修补 <code>IOAHCIBlockStorage.kext</code>，以在第三方驱动器启用 TRIM、硬盘休眠等功能。</p>
<p><em>注</em>：NVMe SSD 通常无需这一修改。对于 AHCI SSD（如 SATA SSD），macOS 从 10.15 开始提供 <code>trimforce</code>，可以将 <code>01 00 00 00</code> 值写入 <code>APPLE_BOOT_VARIABLE_GUID</code> 命名空间中的 <code>EnableTRIM</code> 变量。</p>
<h3 id="XhciPortLimit"><a href="#XhciPortLimit" class="headerlink" title="XhciPortLimit"></a><code>XhciPortLimit</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: 修补 <code>AppleUSBXHCI.kext</code>、<code>AppleUSBXHCIPCI.kext</code>、<code>IOUSBHostFamily.kext</code> 以移除 15 端口限制。</p>
<p><em>注</em>：请尽可能避免使用这一选项。USB port limit is imposed by the amount of used bits in locationID format and there is no possible way to workaround this without heavy OS modification. The only valid solution is to limit the amount of used ports to 15 (discarding some). More details can be found on <a href="https://applelife.ru/posts/550233" target="_blank" rel="noopener">AppleLife.ru</a>.</p>

            </div>

            <ul class="doku-pagination">
            <li class="page-item page-prev">
                <a href="/6-device-properties.html">
                    <div class="page-item-subtitle"><span class="icon is-small"><i class="fas fa-arrow-left"></i></span> <span>前一页</span></div>
                    <div class="page-item-title h5">6. DeviceProperties</div>
                </a>
            </li>
            <li class="page-item page-next">
                <a href="/8-misc.html">
                    <div class="page-item-subtitle"><span>后一页</span> <span class="icon is-small"><i class="fas fa-arrow-right"></i></span></div>
                    <div class="page-item-title h5">8. Misc</div>
                </a>
            </li></ul>
        </div>
        
        <div class="column is-3 is-narrow-touch is-hidden-mobile">
            <aside class="doku-document-toc" id="doku-document-toc">
                <div class="doku-document-toc-content">
                    <p class="doku-document-toc-title">目录</p>
                    <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7-1-简介"><span class="post-toc-text">7.1 简介</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7-2-属性列表"><span class="post-toc-text">7.2 属性列表</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-2-1-Add"><span class="post-toc-text">7.2.1 Add</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-2-2-Block"><span class="post-toc-text">7.2.2 Block</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-2-3-Emulate"><span class="post-toc-text">7.2.3 Emulate</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-2-4-Patch"><span class="post-toc-text">7.2.4 Patch</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-2-5-Quirks"><span class="post-toc-text">7.2.5 Quirks</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7-3-Add-属性"><span class="post-toc-text">7.3 Add 属性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-3-1-BundlePath"><span class="post-toc-text">7.3.1 BundlePath</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-3-2-Comment"><span class="post-toc-text">7.3.2 Comment</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-3-3-Enabled"><span class="post-toc-text">7.3.3 Enabled</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-3-4-ExecutablePath"><span class="post-toc-text">7.3.4 ExecutablePath</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-3-5-MaxKernel"><span class="post-toc-text">7.3.5 MaxKernel</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-3-6-MinKernel"><span class="post-toc-text">7.3.6 MinKernel</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-3-7-PlistPath"><span class="post-toc-text">7.3.7 PlistPath</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7-4-Block-属性"><span class="post-toc-text">7.4 Block 属性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-4-1-Comment"><span class="post-toc-text">7.4.1 Comment</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-4-2-Enabled"><span class="post-toc-text">7.4.2 Enabled</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-4-3-Identifier"><span class="post-toc-text">7.4.3 Identifier</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-4-4-MaxKernel"><span class="post-toc-text">7.4.4 MaxKernel</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-4-5-MinKernel"><span class="post-toc-text">7.4.5 MinKernel</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7-5-Emulate-属性"><span class="post-toc-text">7.5 Emulate 属性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-5-1-Cpuid1Data"><span class="post-toc-text">7.5.1 Cpuid1Data</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-5-2-Cpuid1Mask"><span class="post-toc-text">7.5.2 Cpuid1Mask</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7-6-Patch-属性"><span class="post-toc-text">7.6 Patch 属性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-1-Base"><span class="post-toc-text">7.6.1 Base</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-2-Comment"><span class="post-toc-text">7.6.2 Comment</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-3-Count"><span class="post-toc-text">7.6.3 Count</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-4-Enabled"><span class="post-toc-text">7.6.4 Enabled</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-5-Find"><span class="post-toc-text">7.6.5 Find</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-6-Identifier"><span class="post-toc-text">7.6.6 Identifier</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-7-Limit"><span class="post-toc-text">7.6.7 Limit</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-8-Mask"><span class="post-toc-text">7.6.8 Mask</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-9-MaxKernel"><span class="post-toc-text">7.6.9 MaxKernel</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-10-MinKernel"><span class="post-toc-text">7.6.10 MinKernel</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-11-Replace"><span class="post-toc-text">7.6.11 Replace</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-12-ReplaceMask"><span class="post-toc-text">7.6.12 ReplaceMask</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-13-Skip"><span class="post-toc-text">7.6.13 Skip</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7-7-Quirks-属性"><span class="post-toc-text">7.7 Quirks 属性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#AppleCpuPmCfgLock"><span class="post-toc-text">AppleCpuPmCfgLock</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#AppleXcpmCfgLock"><span class="post-toc-text">AppleXcpmCfgLock</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#AppleXcpmExtraMsrs"><span class="post-toc-text">AppleXcpmExtraMsrs</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#AppleXcpmForceBoost"><span class="post-toc-text">AppleXcpmForceBoost</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#CustomSMBIOSGuid"><span class="post-toc-text">CustomSMBIOSGuid</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#DisableIoMapper"><span class="post-toc-text">DisableIoMapper</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#DummyPowerManagement"><span class="post-toc-text">DummyPowerManagement</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ExternalDiskIcons"><span class="post-toc-text">ExternalDiskIcons</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#IncreasePciBarSize"><span class="post-toc-text">IncreasePciBarSize</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#LapicKernelPanic"><span class="post-toc-text">LapicKernelPanic</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#PanicNoKextDump"><span class="post-toc-text">PanicNoKextDump</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#PowerTimeoutKernelPanic"><span class="post-toc-text">PowerTimeoutKernelPanic</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ThirdPartyDrives"><span class="post-toc-text">ThirdPartyDrives</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#XhciPortLimit"><span class="post-toc-text">XhciPortLimit</span></a></li></ol></li></ol>
                </div>
            </aside>
        </div>
        
    </div>
</article>

                <footer>
    <div class="doku-footer-container is-clearfix">
        <div class="doku-footer-item is-pulled-left">&copy; <span id="doku-copyrght-year"></span> <a href="/">OpenCore 简体中文参考手册(非官方)</a></div>

        <div class="doku-footer-item is-pulled-right">Powered by <a href="https://hexo.io" target="_blank" rel="external noopenner nofollow">Hexo</a> & <a href="https://github.com/SukkaW/hexo-theme-doku" target="_blank" rel="external noopenner nofollow">Doku</a></div>
    </div>
</footer>

            </main>
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/stickyfilljs@2.1.0/dist/stickyfill.min.js"></script>
    <script src="/theme-doku/js/doku.js"></script>
</body>

</html>
