<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
<title>7. Kernel | OpenCore 简体中文参考手册(非官方)</title>
<meta name="generator" content="Hexo 4.2.0">
<meta http-equiv="x-dns-prefetch-control" content="on">
<meta name="description" content="由 Sukka 和黑苹果爱好者们维护的 OpenCore 文档简体中文翻译，实时更新 OpenCore 上游文档改动。努力提供权威的 OpenCore 简体中文参考资料。">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/logo/favicon.ico">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.16.2/styles/github.min.css">
<link rel="stylesheet" href="/theme-doku/css/doku.css">

</head>

<body>
    

<nav id="doku-navbar" class="navbar is-spaced has-shadow">
    <div class="container">
        <div class="navbar-brand">
            <!-- burger btn -->
            <a role="button" class="navbar-burger burger" id="doku-sidebar-toggle">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>

            <a class="navbar-item" href="https://oc.skk.moe">
                <h1 class="doku-navbar-title">
                    <img src="/logo/navbar.png" height="28">
                    <span class="is-size-4"></span>
                </h1>
            </a>
        </div>
        <div class="navbar-menu">
            <div class="navbar-start">
                
                    <a class="navbar-item" href="/">
                        
                        
                            <span>OpenCore 参考手册(简体中文)</span>
                        
                    </a>
                
                    <a class="navbar-item" href="/search.html">
                        
                            <span class="icon">
                                <i class="fas fa-search"></i>
                            </span>
                        
                        
                            <span>站内搜索</span>
                        
                    </a>
                
                    <a class="navbar-item" href="https://github.com/SukkaW/OpenCore-Document-zh_Hans" target="_blank" rel="noopener">
                        
                            <span class="icon">
                                <i class="fab fa-github"></i>
                            </span>
                        
                        
                            <span>GitHub</span>
                        
                    </a>
                
                <!-- navbar link -->
                <!--<a class="navbar-item">
                Home
            </a>-->
            </div>
            <!-- i18n switch -->
            <div class="navbar-end">
                <!--<div class="navbar-item">
                    <div class="dropdown is-right is-hoverable">
                        <div class="dropdown-trigger">
                            <button class="button" id="navbar-i18n-btn">
                                <span class="icon is-small">
                                    <i class="fas fa-globe-americas" aria-hidden="true"></i>
                                </span>
                                <span>Language</span>
                                <span class="icon is-small">
                                    <i class="fas fa-angle-down" aria-hidden="true"></i>
                                </span>
                            </button>
                        </div>
                        <div class="dropdown-menu">
                            <div class="dropdown-content">
                                <a href="#" class="dropdown-item">
                                    Dropdown item
                                </a>
                                <a class="dropdown-item">
                                    Other dropdown item
                                </a>
                                <a href="#" class="dropdown-item">
                                    Active dropdown item
                                </a>
                                <a href="#" class="dropdown-item">
                                    Other dropdown item
                                </a>
                            </div>
                        </div>
                    </div>
                </div>-->
            </div>
        </div>
    </div>
</nav>


    <div class="container-fluid">
        <section class="main-content">
            


<aside class="doku-sidebar" id="doku-sidebar">
    <div class="doku-sidebar-content">
        <div class="menu">
            
                <ul class="menu-list is-hidden-desktop">
                    
                        
                            <li><a href="/">OpenCore 参考手册(简体中文)</span></a></li>
                        
                    
                        
                            <li><a href="/search.html">站内搜索</span></a></li>
                        
                    
                        
                            <li><a href="https://github.com/SukkaW/OpenCore-Document-zh_Hans" target="_blank" rel="noopener">GitHub</span></a></li>
                        
                    
                </ul>
            
            <hr class="is-hidden-desktop">
            
                
                    <ul class="menu-list">
                        
                            <li><a  href="/">0. 首页</a></li>
                        
                            <li><a  href="/1-introduction.html">1. 简介</a></li>
                        
                            <li><a  href="/2-configuration.html">2. 配置</a></li>
                        
                            <li><a  href="/3-setup.html">3. Setup</a></li>
                        
                            <li><a  href="/4-acpi.html">4. ACPI</a></li>
                        
                            <li><a  href="/5-booter.html">5. Booter</a></li>
                        
                            <li><a  href="/6-device-properties.html">6. DeviceProperties</a></li>
                        
                            <li><a class="is-current" href="/7-kernel.html">7. Kernel</a></li>
                        
                            <li><a  href="/8-misc.html">8. Misc</a></li>
                        
                            <li><a  href="/9-nvram.html">9. NVRAM</a></li>
                        
                            <li><a  href="/10-platform-info.html">10. PlatformInfo</a></li>
                        
                            <li><a  href="/11-uefi.html">11. UEFI</a></li>
                        
                            <li><a  href="/12-troubleshooting.html">12. 排错</a></li>
                        
                    </ul>
                
            
        </div>
    </div>
</aside>

            <main class="is-paddingless doku-main-wrapper" id="doku-main">
                

<article class="doku-document-container clearfix">
    <header class="hero is-light" id="doku-document-hero">
        <div class="hero-body">
            <h1 class="title">7. Kernel</h1>
            
                <p class="subtitle">OpenCore 安全配置，Kext 加载顺序以及屏蔽（待翻译）</p>
            
            
                
                    <p><small>由 Sukka 整理</small></p>
                
                
                <br>
            
            
                <a href="https://github.com/sukkaw/OpenCore-Document-zh_Hans/tree/master/source/7-kernel.md" target="_blank" rel="external nofollow noreferrer noopener" class="button is-small is-rounded is-black"><span class="icon is-small"><i class="fab fa-github"></i></span><span>在 GitHub 上编辑</span></a>
            
        </div>
    </header>
    <div class="columns">
        <div class="column is-9-tablet doku-document-wrapper">
            <div class="content">
                <h2 id="7-1-简介"><a href="#7-1-简介" class="headerlink" title="7.1 简介"></a>7.1 简介</h2><p>This section allows to apply different kinds of kernelspace modifications on Apple Kernel (<a href="https://opensource.apple.com/source/xnu" target="_blank" rel="noopener">XNU</a>). The modifications currently provide driver (kext) injection, kernel and driver patching, and driver blocking.</p>
<h2 id="7-2-属性列表"><a href="#7-2-属性列表" class="headerlink" title="7.2 属性列表"></a>7.2 属性列表</h2><h3 id="7-2-1-Add"><a href="#7-2-1-Add" class="headerlink" title="7.2.1 Add"></a>7.2.1 Add</h3><p><strong>Type</strong>: plist array<br><strong>Failsafe</strong>: Empty<br><strong>Description</strong>: Load selected kernel drivers from <code>OC/Kexts</code> directory.</p>
<p>Designed to be filled with plist dict values, describing each driver. See Add Properties section below. Kernel driver load order follows the item order in the array, thus the dependencies should be written prior to their<br>consumers.</p>
<h3 id="7-2-2-Block"><a href="#7-2-2-Block" class="headerlink" title="7.2.2 Block"></a>7.2.2 Block</h3><p><strong>Type</strong>: plist array<br><strong>Failsafe</strong>: Empty<br><strong>Description</strong>: Remove selected kernel drivers from prelinked kernel.</p>
<p>Designed to be filled with plist dictionary values, describing each blocked driver. See Block Properties section below.</p>
<h3 id="7-2-3-Emulate"><a href="#7-2-3-Emulate" class="headerlink" title="7.2.3 Emulate"></a>7.2.3 Emulate</h3><p><strong>Type</strong>: plist dict<br><strong>Description</strong>: Emulate select hardware in kernelspace via parameters described in Emulate Properties section below.</p>
<h3 id="7-2-4-Patch"><a href="#7-2-4-Patch" class="headerlink" title="7.2.4 Patch"></a>7.2.4 Patch</h3><p><strong>Type</strong>: plist array<br><strong>Failsafe</strong>: Empty<br><strong>Description</strong>: Perform binary patches in kernel and drivers prior to driver addition and removal.</p>
<p>Designed to be filled with plist dictionary values, describing each patch. See Patch Properties section below.</p>
<h3 id="7-2-5-Quirks"><a href="#7-2-5-Quirks" class="headerlink" title="7.2.5 Quirks"></a>7.2.5 Quirks</h3><p><strong>Type</strong>: plist dict<br><strong>Description</strong>: Apply individual kernel and driver quirks described in Quirks Properties section below.</p>
<h2 id="7-3-Add-属性"><a href="#7-3-Add-属性" class="headerlink" title="7.3 Add 属性"></a>7.3 Add 属性</h2><h3 id="7-3-1-BundlePath"><a href="#7-3-1-BundlePath" class="headerlink" title="7.3.1 BundlePath"></a>7.3.1 <code>BundlePath</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Kext bundle path (e.g. <code>Lilu.kext</code> or <code>MyKext.kext/Contents/PlugIns/MySubKext.kext</code>).</p>
<h3 id="7-3-2-Comment"><a href="#7-3-2-Comment" class="headerlink" title="7.3.2 Comment"></a>7.3.2 <code>Comment</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Arbitrary ASCII string used to provide human readable reference for the entry. It is implementation defined whether this value is used.</p>
<h3 id="7-3-3-Enabled"><a href="#7-3-3-Enabled" class="headerlink" title="7.3.3 Enabled"></a>7.3.3 <code>Enabled</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: This kernel driver will not be added unless set to <code>true</code>.</p>
<h3 id="7-3-4-ExecutablePath"><a href="#7-3-4-ExecutablePath" class="headerlink" title="7.3.4 ExecutablePath"></a>7.3.4 <code>ExecutablePath</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Kext executable path relative to bundle (e.g. <code>Contents/MacOS/Lilu</code>).</p>
<h3 id="7-3-5-MaxKernel"><a href="#7-3-5-MaxKernel" class="headerlink" title="7.3.5 MaxKernel"></a>7.3.5 <code>MaxKernel</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Adds kernel driver on specified macOS version or older.</p>
<p>Kernel version can be obtained with <code>uname -r</code> command, and should look like 3 numbers separated by dots, for example <code>18.7.0</code> is the kernel version for <code>10.14.6</code>. Kernel version interpretation is implemented as follows:</p>
<p><img src="/img/7-1.png" alt="7-1.png"></p>
<p>Kernel version comparison is implemented as follows:</p>
<p><img src="/img/7-2.png" alt="7-2.png"></p>
<p>Here <code>ParseDarwinVersion</code> argument is assumed to be 3 integers obtained by splitting Darwin kernel version string from left to right by the <code>.</code> symbol. <code>FindDarwinVersion</code> function looks up Darwin kernel version by locating <img src="/img/7-3.png" alt=""> string in the kernel image.</p>
<h3 id="7-3-6-MinKernel"><a href="#7-3-6-MinKernel" class="headerlink" title="7.3.6 MinKernel"></a>7.3.6 <code>MinKernel</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Adds kernel driver on specified macOS version or newer.</p>
<p><em>Note</em>: Refer to <a href="#kernmatch"><code>Add</code> <code>MaxKernel</code> description</a> for<br>matching logic.</p>
<h3 id="7-3-7-PlistPath"><a href="#7-3-7-PlistPath" class="headerlink" title="7.3.7 PlistPath"></a>7.3.7 <code>PlistPath</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Kext <code>Info.plist</code> path relative to bundle (e.g. <code>Contents/Info.plist</code>).</p>
<h2 id="7-4-Block-属性"><a href="#7-4-Block-属性" class="headerlink" title="7.4 Block 属性"></a>7.4 Block 属性</h2><h3 id="7-4-1-Comment"><a href="#7-4-1-Comment" class="headerlink" title="7.4.1 Comment"></a>7.4.1 <code>Comment</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Arbitrary ASCII string used to provide human readable reference for the entry. It is implementation defined whether this value is used.</p>
<h3 id="7-4-2-Enabled"><a href="#7-4-2-Enabled" class="headerlink" title="7.4.2 Enabled"></a>7.4.2 <code>Enabled</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: This kernel driver will not be blocked unless set to <code>true</code>.</p>
<h3 id="7-4-3-Identifier"><a href="#7-4-3-Identifier" class="headerlink" title="7.4.3 Identifier"></a>7.4.3 <code>Identifier</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Kext bundle identifier (e.g.<br><code>com.apple.driver.AppleTyMCEDriver</code>).</p>
<h3 id="7-4-4-MaxKernel"><a href="#7-4-4-MaxKernel" class="headerlink" title="7.4.4 MaxKernel"></a>7.4.4 <code>MaxKernel</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Blocks kernel driver on specified macOS version or older.</p>
<p><em>Note</em>: Refer to <a href="#kernmatch"><code>Add</code> <code>MaxKernel</code> description</a> for matching logic.</p>
<h3 id="7-4-5-MinKernel"><a href="#7-4-5-MinKernel" class="headerlink" title="7.4.5 MinKernel"></a>7.4.5 <code>MinKernel</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Blocks kernel driver on specified macOS version or newer.</p>
<p><em>Note</em>: Refer to <a href="#kernmatch"><code>Add</code> <code>MaxKernel</code> description</a> for<br>matching logic.</p>
<h2 id="7-5-Emulate-属性"><a href="#7-5-Emulate-属性" class="headerlink" title="7.5 Emulate 属性"></a>7.5 Emulate 属性</h2><h3 id="7-5-1-Cpuid1Data"><a href="#7-5-1-Cpuid1Data" class="headerlink" title="7.5.1 Cpuid1Data"></a>7.5.1 <code>Cpuid1Data</code></h3><p><strong>Type</strong>: <code>plist data</code>, 16 bytes<br><strong>Failsafe</strong>: All zero<br><strong>Description</strong>: Sequence of <code>EAX</code>, <code>EBX</code>, <code>ECX</code>, <code>EDX</code> values to replace <code>CPUID (1)</code> call in XNU kernel.</p>
<p>This property serves for two needs:</p>
<ul>
<li>Enabling support of an unsupported CPU model.</li>
<li>Enabling XCPM support for an unsupported CPU variant.</li>
</ul>
<p>Normally it is only the value of <code>EAX</code> that needs to be taken care of, since it represents the full CPUID. The remaining bytes are to be left as zeroes. Byte order is Little Endian, so for example, <code>A9 06 03 00</code> stands for CPUID <code>0x0306A9</code> (Ivy Bridge).</p>
<p>For XCPM support it is recommended to use the following combinations.</p>
<ul>
<li><p>Haswell-E (<code>0x306F2</code>) to Haswell (<code>0x0306C3</code>):</p>
<p><code>Cpuid1Data</code>: <code>C3 06 03 00 00 00 00 00 00 00 00 00 00 00 00 00</code><br><code>Cpuid1Mask</code>: <code>FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00</code></p>
</li>
<li><p>Broadwell-E (<code>0x0406F1</code>) to Broadwell (<code>0x0306D4</code>):<br><code>Cpuid1Data</code>: <code>D4 06 03 00 00 00 00 00 00 00 00 00 00 00 00 00</code><br><code>Cpuid1Mask</code>: <code>FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00</code></p>
</li>
</ul>
<p>Further explanations can be found at <a href="https://github.com/acidanthera/bugtracker/issues/365" target="_blank" rel="noopener">acidanthera/bugtracker#365</a>. See <code>Special NOTES</code> for Haswell+ low-end.</p>
<h3 id="7-5-2-Cpuid1Mask"><a href="#7-5-2-Cpuid1Mask" class="headerlink" title="7.5.2 Cpuid1Mask"></a>7.5.2 <code>Cpuid1Mask</code></h3><p><strong>Type</strong>: <code>plist data</code>, 16 bytes<br><strong>Failsafe</strong>: All zero<br><strong>Description</strong>: Bit mask of active bits in <code>Cpuid1Data</code>.</p>
<p>When each <code>Cpuid1Mask</code> bit is set to 0, the original CPU bit is used,<br>otherwise set bits take the value of <code>Cpuid1Data</code>.</p>
<h2 id="7-6-Patch-属性"><a href="#7-6-Patch-属性" class="headerlink" title="7.6 Patch 属性"></a>7.6 Patch 属性</h2><h3 id="7-6-1-Base"><a href="#7-6-1-Base" class="headerlink" title="7.6.1 Base"></a>7.6.1 <code>Base</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Selects symbol-matched base for patch lookup (or immediate replacement) by obtaining the address of provided symbol name. Can be set to empty string to be ignored.</p>
<h3 id="7-6-2-Comment"><a href="#7-6-2-Comment" class="headerlink" title="7.6.2 Comment"></a>7.6.2 <code>Comment</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Arbitrary ASCII string used to provide human readable reference for the entry. It is implementation defined whether this value is used.</p>
<h3 id="7-6-3-Count"><a href="#7-6-3-Count" class="headerlink" title="7.6.3 Count"></a>7.6.3 <code>Count</code></h3><p><strong>Type</strong>: <code>plist integer</code><br><strong>Failsafe</strong>: <code>0</code><br><strong>Description</strong>: Number of patch occurrences to apply. <code>0</code> applies the patch to all occurrences found.</p>
<h3 id="7-6-4-Enabled"><a href="#7-6-4-Enabled" class="headerlink" title="7.6.4 Enabled"></a>7.6.4 <code>Enabled</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: This kernel patch will not be used unless set to <code>true</code>.</p>
<h3 id="7-6-5-Find"><a href="#7-6-5-Find" class="headerlink" title="7.6.5 Find"></a>7.6.5 <code>Find</code></h3><p><strong>Type</strong>: <code>plist data</code><br><strong>Failsafe</strong>: Empty data<br><strong>Description</strong>: Data to find. Can be set to empty for immediate replacement at <code>Base</code>. Must equal to <code>Replace</code> in size otherwise.</p>
<h3 id="7-6-6-Identifier"><a href="#7-6-6-Identifier" class="headerlink" title="7.6.6 Identifier"></a>7.6.6 <code>Identifier</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Kext bundle identifier (e.g.<br><code>com.apple.driver.AppleHDA</code>) or <code>kernel</code> for kernel patch.</p>
<h3 id="7-6-7-Limit"><a href="#7-6-7-Limit" class="headerlink" title="7.6.7 Limit"></a>7.6.7 <code>Limit</code></h3><p><strong>Type</strong>: <code>plist integer</code><br><strong>Failsafe</strong>: <code>0</code><br><strong>Description</strong>: Maximum number of bytes to search for. Can be set to <code>0</code> to look through the whole kext or kernel.</p>
<h3 id="7-6-8-Mask"><a href="#7-6-8-Mask" class="headerlink" title="7.6.8 Mask"></a>7.6.8 <code>Mask</code></h3><p><strong>Type</strong>: <code>plist data</code><br><strong>Failsafe</strong>: Empty data<br><strong>Description</strong>: Data bitwise mask used during find comparison. Allows fuzzy search by ignoring not masked (set to zero) bits. Can be set to empty data to be ignored. Must equal to <code>Replace</code> in size otherwise.</p>
<h3 id="7-6-9-MaxKernel"><a href="#7-6-9-MaxKernel" class="headerlink" title="7.6.9 MaxKernel"></a>7.6.9 <code>MaxKernel</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Patches data on specified macOS version or older.</p>
<p><em>Note</em>: Refer to <a href="#kernmatch"><code>Add</code> <code>MaxKernel</code> description</a> for matching logic.</p>
<h3 id="7-6-10-MinKernel"><a href="#7-6-10-MinKernel" class="headerlink" title="7.6.10 MinKernel"></a>7.6.10 <code>MinKernel</code></h3><p><strong>Type</strong>: <code>plist string</code><br><strong>Failsafe</strong>: Empty string<br><strong>Description</strong>: Patches data on specified macOS version or newer.</p>
<p><em>Note</em>: Refer to <a href="#kernmatch"><code>Add</code> <code>MaxKernel</code> description</a> for matching logic.</p>
<h3 id="7-6-11-Replace"><a href="#7-6-11-Replace" class="headerlink" title="7.6.11 Replace"></a>7.6.11 <code>Replace</code></h3><p><strong>Type</strong>: <code>plist data</code><br><strong>Failsafe</strong>: Empty data<br><strong>Description</strong>: Replacement data of one or more bytes.</p>
<h3 id="7-6-12-ReplaceMask"><a href="#7-6-12-ReplaceMask" class="headerlink" title="7.6.12 ReplaceMask"></a>7.6.12 <code>ReplaceMask</code></h3><p><strong>Type</strong>: <code>plist data</code><br><strong>Failsafe</strong>: Empty data<br><strong>Description</strong>: Data bitwise mask used during replacement. Allows fuzzy replacement by updating masked (set to non-zero) bits. Can be set to empty data to be ignored. Must equal to <code>Replace</code> in size otherwise.</p>
<h3 id="7-6-13-Skip"><a href="#7-6-13-Skip" class="headerlink" title="7.6.13 Skip"></a>7.6.13 <code>Skip</code></h3><p><strong>Type</strong>: <code>plist integer</code><br><strong>Failsafe</strong>: <code>0</code><br><strong>Description</strong>: Number of found occurrences to be skipped before replacement is done.</p>
<h2 id="7-7-Quirks-属性"><a href="#7-7-Quirks-属性" class="headerlink" title="7.7 Quirks 属性"></a>7.7 Quirks 属性</h2><h3 id="7-7-1-AppleCpuPmCfgLock"><a href="#7-7-1-AppleCpuPmCfgLock" class="headerlink" title="7.7.1 AppleCpuPmCfgLock"></a>7.7.1 <code>AppleCpuPmCfgLock</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: Disables <code>PKG_CST_CONFIG_CONTROL</code> (<code>0xE2</code>) MSR modification in AppleIntelCPUPowerManagement.kext, commonly causing early kernel panic, when it is locked from writing.</p>
<p>Certain firmwares lock <code>PKG_CST_CONFIG_CONTROL</code> MSR register. To check<br>its state one can use bundled <code>VerifyMsrE2</code> tool. Select firmwares have<br>this register locked on some cores only.</p>
<p>As modern firmwares provide <code>CFG Lock</code> setting, which allows configuring<br><code>PKG_CST_CONFIG_CONTROL</code> MSR register lock, this option should be<br>avoided whenever possible. For several APTIO firmwares not displaying<br><code>CFG Lock</code> setting in the GUI it is possible to access the option<br>directly:</p>
<ol>
<li>Download <a href="https://github.com/LongSoft/UEFITool/releases" target="_blank" rel="noopener">UEFITool</a> and <a href="https://github.com/LongSoft/Universal-IFR-Extractor/releases" target="_blank" rel="noopener">IFR-Extractor</a>.</li>
<li>Open your firmware image in UEFITool and find CFG Lock unicode string. If it is not present, your firmware may not have this option and you should stop.</li>
<li>Extract the Setup.bin PE32 Image Section (the one UEFITool found) through Extract Body menu option.</li>
<li>Run IFR-Extractor on the extracted file (e.g. ./ifrextract Setup.bin Setup.txt).</li>
<li>Find CFG Lock, VarStoreInfo (VarOffset/VarName): in Setup.txt and remember the offset right after it (e.g. <code>0x123</code>).</li>
<li>Download and run <a href="http://brains.by/posts/bootx64.7z" target="_blank" rel="noopener">Modified GRUB Shell</a> compiled by <a href="https://geektimes.com/post/258090" target="_blank" rel="noopener">brainsucker</a> or use <a href="https://github.com/datasone/grub-mod-setup_var" target="_blank" rel="noopener">a newer version</a> by <a href="https://github.com/datasone" target="_blank" rel="noopener">datasone</a>.</li>
<li>Enter setup_var 0x123 0x00 command, where 0x123 should be replaced by your actual offset, and reboot.</li>
</ol>
<p><strong>WARNING</strong>: Variable offsets are unique not only to each motherboard<br>but even to its firmware version. Never ever try to use an offset<br>without checking.</p>
<p>- <code>AppleXcpmCfgLock</code><br><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: Disables <code>PKG_CST_CONFIG_CONTROL</code> (<code>0xE2</code>) MSR<br>modification in XNU kernel, commonly causing early kernel panic, when it<br>is locked from writing (XCPM power management).</p>
<p><em>Note</em>: This option should be avoided whenever possible. See<br><code>AppleCpuPmCfgLock</code> description for more details.</p>
<h3 id="7-7-2-AppleXcpmExtraMsrs"><a href="#7-7-2-AppleXcpmExtraMsrs" class="headerlink" title="7.7.2 AppleXcpmExtraMsrs"></a>7.7.2 <code>AppleXcpmExtraMsrs</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: Disables multiple MSR access critical for select CPUs, which have no native XCPM support.</p>
<p>This is normally used in conjunction with <code>Emulate</code> section on Haswell-E, Broadwell-E, Skylake-X, and similar CPUs. More details on the XCPM patches are outlined in <a href="https://github.com/acidanthera/bugtracker/issues/365" target="_blank" rel="noopener">acidanthera/bugtracker#365</a>.</p>
<p><em>Note</em>: Additional not provided patches will be required for Ivy Bridge or Pentium CPUs. It is recommended to use <code>AppleIntelCpuPowerManagement.kext</code> for the former.</p>
<h3 id="7-7-3-AppleXcpmForceBoost"><a href="#7-7-3-AppleXcpmForceBoost" class="headerlink" title="7.7.3 AppleXcpmForceBoost"></a>7.7.3 <code>AppleXcpmForceBoost</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: Forces maximum performance in XCPM mode.</p>
<p>This patch writes <code>0xFF00</code> to <code>MSR_IA32_PERF_CONTROL</code> (<code>0x199</code>), effectively setting maximum multiplier for all the time.</p>
<p><em>Note</em>: While this may increase the performance, this patch is strongly discouraged on all systems but those explicitly dedicated to scientific or media calculations. In general only certain Xeon models benefit from the patch.</p>
<h3 id="7-7-3-CustomSMBIOSGuid"><a href="#7-7-3-CustomSMBIOSGuid" class="headerlink" title="7.7.3 CustomSMBIOSGuid"></a>7.7.3 <code>CustomSMBIOSGuid</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: Performs GUID patching for <code>UpdateSMBIOSMode</code> <code>Custom</code> mode. Usually relevant for Dell laptops.</p>
<h3 id="7-7-4-DisableIoMapper"><a href="#7-7-4-DisableIoMapper" class="headerlink" title="7.7.4 DisableIoMapper"></a>7.7.4 <code>DisableIoMapper</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: Disables <code>IOMapper</code> support in XNU (VT-d), which may conflict with the firmware implementation.</p>
<p><em>Note</em>: This option is a preferred alternative to dropping <code>DMAR</code> ACPI table and disabling VT-d in firmware preferences, which does not break VT-d support in other systems in case they need it.</p>
<h3 id="7-7-5-DummyPowerManagement"><a href="#7-7-5-DummyPowerManagement" class="headerlink" title="7.7.5 DummyPowerManagement"></a>7.7.5 <code>DummyPowerManagement</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: Disables <code>AppleIntelCpuPowerManagement</code>.</p>
<p><em>Note</em>: This option is a preferred alternative to <code>NullCpuPowerManagement.kext</code> for CPUs without native power management driver in macOS.</p>
<h3 id="7-7-6-ExternalDiskIcons"><a href="#7-7-6-ExternalDiskIcons" class="headerlink" title="7.7.6 ExternalDiskIcons"></a>7.7.6 <code>ExternalDiskIcons</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: Apply icon type patches to <code>AppleAHCIPort.kext</code> to force internal disk icons for all AHCI disks.</p>
<p><em>Note</em>: This option should be avoided whenever possible. Modern firmwares usually have compatible AHCI controllers.</p>
<h3 id="7-7-7-IncreasePciBarSize"><a href="#7-7-7-IncreasePciBarSize" class="headerlink" title="7.7.7 IncreasePciBarSize"></a>7.7.7 <code>IncreasePciBarSize</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: Increases 32-bit PCI bar size in IOPCIFamily from 1 to 4 GBs.</p>
<p><em>Note</em>: This option should be avoided whenever possible. In general the necessity of this option means misconfigured or broken firmware.</p>
<h3 id="7-7-8-LapicKernelPanic"><a href="#7-7-8-LapicKernelPanic" class="headerlink" title="7.7.8 LapicKernelPanic"></a>7.7.8 <code>LapicKernelPanic</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: Disables kernel panic on LAPIC interrupts.</p>
<h3 id="7-7-9-PanicNoKextDump"><a href="#7-7-9-PanicNoKextDump" class="headerlink" title="7.7.9 PanicNoKextDump"></a>7.7.9 <code>PanicNoKextDump</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: Prevent kernel from printing kext dump in the panic log preventing from observing panic details. Affects 10.13 and above.</p>
<h3 id="7-7-10-PowerTimeoutKernelPanic"><a href="#7-7-10-PowerTimeoutKernelPanic" class="headerlink" title="7.7.10 PowerTimeoutKernelPanic"></a>7.7.10 <code>PowerTimeoutKernelPanic</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: Disables kernel panic on setPowerState timeout.</p>
<p>An additional security measure was added to macOS Catalina (10.15) causing kernel panic on power change timeout for Apple drivers. Sometimes it may cause issues on misconfigured hardware, notably digital audio, which sometimes fails to wake up. For debug kernels <code>setpowerstate_panic=0</code> boot argument should be used, which is otherwise equivalent to this quirk.</p>
<h3 id="7-7-11-ThirdPartyDrives"><a href="#7-7-11-ThirdPartyDrives" class="headerlink" title="7.7.11 ThirdPartyDrives"></a>7.7.11 <code>ThirdPartyDrives</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: Apply vendor patches to IOAHCIBlockStorage.kext to enable native features for third-party drives, such as TRIM on SSDs or hibernation support on 10.15 and newer.</p>
<p><em>Note</em>: This option may be avoided on user preference. NVMe SSDs are compatible without the change. For AHCI SSDs on modern macOS version there is a dedicated built-in utility called <code>trimforce</code>. Starting from 10.15 this utility creates <code>EnableTRIM</code> variable in <code>APPLE_BOOT_VARIABLE_GUID</code> namespace with <code>01 00 00 00</code> value.</p>
<h3 id="7-7-12-XhciPortLimit"><a href="#7-7-12-XhciPortLimit" class="headerlink" title="7.7.12 XhciPortLimit"></a>7.7.12 <code>XhciPortLimit</code></h3><p><strong>Type</strong>: <code>plist boolean</code><br><strong>Failsafe</strong>: <code>false</code><br><strong>Description</strong>: Patch various kexts (AppleUSBXHCI.kext, AppleUSBXHCIPCI.kext, IOUSBHostFamily.kext) to remove USB port count<br>limit of 15 ports.</p>
<p><em>Note</em>: This option should be avoided whenever possible. USB port limit is imposed by the amount of used bits in locationID format and there is no possible way to workaround this without heavy OS modification. The only valid solution is to limit the amount of used ports to 15 (discarding some). More details can be found on <a href="https://applelife.ru/posts/550233" target="_blank" rel="noopener">AppleLife.ru</a>.</p>

            </div>

            <ul class="doku-pagination">
            <li class="page-item page-prev">
                <a href="/6-device-properties.html">
                    <div class="page-item-subtitle"><span class="icon is-small"><i class="fas fa-arrow-left"></i></span> <span>前一页</span></div>
                    <div class="page-item-title h5">6. DeviceProperties</div>
                </a>
            </li>
            <li class="page-item page-next">
                <a href="/8-misc.html">
                    <div class="page-item-subtitle"><span>后一页</span> <span class="icon is-small"><i class="fas fa-arrow-right"></i></span></div>
                    <div class="page-item-title h5">8. Misc</div>
                </a>
            </li></ul>
        </div>
        
        <div class="column is-3 is-narrow-touch is-hidden-mobile">
            <aside class="doku-document-toc" id="doku-document-toc">
                <div class="doku-document-toc-content">
                    <p class="doku-document-toc-title">目录</p>
                    <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7-1-简介"><span class="post-toc-text">7.1 简介</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7-2-属性列表"><span class="post-toc-text">7.2 属性列表</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-2-1-Add"><span class="post-toc-text">7.2.1 Add</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-2-2-Block"><span class="post-toc-text">7.2.2 Block</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-2-3-Emulate"><span class="post-toc-text">7.2.3 Emulate</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-2-4-Patch"><span class="post-toc-text">7.2.4 Patch</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-2-5-Quirks"><span class="post-toc-text">7.2.5 Quirks</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7-3-Add-属性"><span class="post-toc-text">7.3 Add 属性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-3-1-BundlePath"><span class="post-toc-text">7.3.1 BundlePath</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-3-2-Comment"><span class="post-toc-text">7.3.2 Comment</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-3-3-Enabled"><span class="post-toc-text">7.3.3 Enabled</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-3-4-ExecutablePath"><span class="post-toc-text">7.3.4 ExecutablePath</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-3-5-MaxKernel"><span class="post-toc-text">7.3.5 MaxKernel</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-3-6-MinKernel"><span class="post-toc-text">7.3.6 MinKernel</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-3-7-PlistPath"><span class="post-toc-text">7.3.7 PlistPath</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7-4-Block-属性"><span class="post-toc-text">7.4 Block 属性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-4-1-Comment"><span class="post-toc-text">7.4.1 Comment</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-4-2-Enabled"><span class="post-toc-text">7.4.2 Enabled</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-4-3-Identifier"><span class="post-toc-text">7.4.3 Identifier</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-4-4-MaxKernel"><span class="post-toc-text">7.4.4 MaxKernel</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-4-5-MinKernel"><span class="post-toc-text">7.4.5 MinKernel</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7-5-Emulate-属性"><span class="post-toc-text">7.5 Emulate 属性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-5-1-Cpuid1Data"><span class="post-toc-text">7.5.1 Cpuid1Data</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-5-2-Cpuid1Mask"><span class="post-toc-text">7.5.2 Cpuid1Mask</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7-6-Patch-属性"><span class="post-toc-text">7.6 Patch 属性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-1-Base"><span class="post-toc-text">7.6.1 Base</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-2-Comment"><span class="post-toc-text">7.6.2 Comment</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-3-Count"><span class="post-toc-text">7.6.3 Count</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-4-Enabled"><span class="post-toc-text">7.6.4 Enabled</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-5-Find"><span class="post-toc-text">7.6.5 Find</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-6-Identifier"><span class="post-toc-text">7.6.6 Identifier</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-7-Limit"><span class="post-toc-text">7.6.7 Limit</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-8-Mask"><span class="post-toc-text">7.6.8 Mask</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-9-MaxKernel"><span class="post-toc-text">7.6.9 MaxKernel</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-10-MinKernel"><span class="post-toc-text">7.6.10 MinKernel</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-11-Replace"><span class="post-toc-text">7.6.11 Replace</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-12-ReplaceMask"><span class="post-toc-text">7.6.12 ReplaceMask</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-6-13-Skip"><span class="post-toc-text">7.6.13 Skip</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7-7-Quirks-属性"><span class="post-toc-text">7.7 Quirks 属性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-7-1-AppleCpuPmCfgLock"><span class="post-toc-text">7.7.1 AppleCpuPmCfgLock</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-7-2-AppleXcpmExtraMsrs"><span class="post-toc-text">7.7.2 AppleXcpmExtraMsrs</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-7-3-AppleXcpmForceBoost"><span class="post-toc-text">7.7.3 AppleXcpmForceBoost</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-7-3-CustomSMBIOSGuid"><span class="post-toc-text">7.7.3 CustomSMBIOSGuid</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-7-4-DisableIoMapper"><span class="post-toc-text">7.7.4 DisableIoMapper</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-7-5-DummyPowerManagement"><span class="post-toc-text">7.7.5 DummyPowerManagement</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-7-6-ExternalDiskIcons"><span class="post-toc-text">7.7.6 ExternalDiskIcons</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-7-7-IncreasePciBarSize"><span class="post-toc-text">7.7.7 IncreasePciBarSize</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-7-8-LapicKernelPanic"><span class="post-toc-text">7.7.8 LapicKernelPanic</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-7-9-PanicNoKextDump"><span class="post-toc-text">7.7.9 PanicNoKextDump</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-7-10-PowerTimeoutKernelPanic"><span class="post-toc-text">7.7.10 PowerTimeoutKernelPanic</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-7-11-ThirdPartyDrives"><span class="post-toc-text">7.7.11 ThirdPartyDrives</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-7-12-XhciPortLimit"><span class="post-toc-text">7.7.12 XhciPortLimit</span></a></li></ol></li></ol>
                </div>
            </aside>
        </div>
        
    </div>
</article>

                <footer>
    <div class="doku-footer-container is-clearfix">
        <div class="doku-footer-item is-pulled-left">&copy; <span id="doku-copyrght-year"></span> <a href="/">OpenCore 简体中文参考手册(非官方)</a></div>

        <div class="doku-footer-item is-pulled-right">Powered by <a href="https://hexo.io" target="_blank" rel="external noopenner nofollow">Hexo</a> & <a href="https://github.com/SukkaW/hexo-theme-doku" target="_blank" rel="external noopenner nofollow">Doku</a></div>
    </div>
</footer>

            </main>
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/stickyfilljs@2.1.0/dist/stickyfill.min.js"></script>
    <script src="/theme-doku/js/doku.js"></script>
</body>

</html>
