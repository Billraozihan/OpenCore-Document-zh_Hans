<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
<title>8. Misc | OpenCore 简体中文参考手册(非官方)</title>
<meta name="generator" content="Hexo 4.2.0">
<meta http-equiv="x-dns-prefetch-control" content="on">
<meta name="description" content="OpenCore 文档简体中文翻译">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/logo/favicon.ico">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.16.2/styles/github.min.css">
<link rel="stylesheet" href="/theme-doku/css/doku.css">

</head>

<body>
    

<nav id="doku-navbar" class="navbar is-spaced has-shadow">
    <div class="container">
        <div class="navbar-brand">
            <!-- burger btn -->
            <a role="button" class="navbar-burger burger" id="doku-sidebar-toggle">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>

            <a class="navbar-item" href="https://oc.skk.moe">
                <h1 class="doku-navbar-title">
                    <img src="/logo/navbar.png" height="28">
                    <span class="is-size-4"></span>
                </h1>
            </a>
        </div>
        <div class="navbar-menu">
            <div class="navbar-start">
                
                    <a class="navbar-item" href="https://github.com/SukkaW/OpenCore-Document-zh_Hans" target="_blank" rel="noopener">
                        
                            <span class="icon">
                                <i class="fab fa-github"></i>
                            </span>
                        
                        
                    </a>
                
                <!-- navbar link -->
                <!--<a class="navbar-item">
                Home
            </a>-->
            </div>
            <!-- i18n switch -->
            <div class="navbar-end">
                <!--<div class="navbar-item">
                    <div class="dropdown is-right is-hoverable">
                        <div class="dropdown-trigger">
                            <button class="button" id="navbar-i18n-btn">
                                <span class="icon is-small">
                                    <i class="fas fa-globe-americas" aria-hidden="true"></i>
                                </span>
                                <span>Language</span>
                                <span class="icon is-small">
                                    <i class="fas fa-angle-down" aria-hidden="true"></i>
                                </span>
                            </button>
                        </div>
                        <div class="dropdown-menu">
                            <div class="dropdown-content">
                                <a href="#" class="dropdown-item">
                                    Dropdown item
                                </a>
                                <a class="dropdown-item">
                                    Other dropdown item
                                </a>
                                <a href="#" class="dropdown-item">
                                    Active dropdown item
                                </a>
                                <a href="#" class="dropdown-item">
                                    Other dropdown item
                                </a>
                            </div>
                        </div>
                    </div>
                </div>-->
            </div>
        </div>
    </div>
</nav>


    <div class="container-fluid">
        <section class="main-content">
            


<aside class="doku-sidebar" id="doku-sidebar">
    <div class="doku-sidebar-content">
        <div class="menu">
            
                <ul class="menu-list is-hidden-desktop">
                    
                        
                    
                </ul>
            
            <hr class="is-hidden-desktop">
            
                
                    <ul class="menu-list">
                        
                            <li><a  href="/">0. 首页</a></li>
                        
                            <li><a  href="/1-introduction.html">1. 简介</a></li>
                        
                            <li><a  href="/2-configuration.html">2. 配置</a></li>
                        
                            <li><a  href="/3-setup.html">3. Setup</a></li>
                        
                            <li><a  href="/4-acpi.html">4. ACPI</a></li>
                        
                            <li><a  href="/5-booter.html">5. Booter</a></li>
                        
                            <li><a  href="/6-device-properties.html">6. DeviceProperties</a></li>
                        
                            <li><a  href="/7-kernel.html">7. Kernel</a></li>
                        
                            <li><a class="is-current" href="/8-misc.html">8. Misc</a></li>
                        
                            <li><a  href="/9-nvram.html">9. NVRAM</a></li>
                        
                            <li><a  href="/10-platform-info.html">10. PlatformInfo</a></li>
                        
                            <li><a  href="/11-uefi.html">11. UEFI</a></li>
                        
                            <li><a  href="/12-troubleshooting.html">12. 排错</a></li>
                        
                    </ul>
                
            
        </div>
    </div>
</aside>

            <main class="is-paddingless doku-main-wrapper" id="doku-main">
                

<article class="doku-document-container clearfix">
    <header class="hero is-light" id="doku-document-hero">
        <div class="hero-body">
            <h1 class="title">8. Misc</h1>
            
                <p class="subtitle">Misc（待整理）</p>
            
            
                <a href="https://github.com/sukkaw/OpenCore-Document-zh_Hans/tree/master/source/8-misc.md" target="_blank" rel="external nofollow noreferrer noopener" class="button is-small is-rounded is-black"><span class="icon is-small"><i class="fab fa-github"></i></span><span>在 GitHub 上编辑</span></a>
            
        </div>
    </header>
    <div class="columns">
        <div class="column doku-document-wrapper">
            <div class="content">
                
                <p>\subsection{Introduction}\label{miscintro}</p>
<p>This section contains miscellaneous configuration entries for OpenCore<br>behaviour that does not go to any other sections</p>
<p>\subsection{Properties}\label{miscprops}</p>
<p>\begin{enumerate}</p>
<ul>
<li><p>\texttt{Boot}\<br>\textbf{Type}: \texttt{plist\ dict}\<br>\textbf{Description}: Apply boot configuration described in<br>\hyperref[miscbootprops]{Boot Properties} section below.</p>
</li>
<li><p>\texttt{BlessOverride}\<br>\textbf{Type}: \texttt{plist\ array}\<br>\textbf{Description}: Add custom scanning paths through bless model.</p>
<p>Designed to be filled with \texttt{plist\ string} entries containing<br>absolute UEFI paths to customised bootloaders, for example,<br>\texttt{\textbackslash EFI\textbackslash Microsoft\textbackslash Boot\textbackslash bootmgfw.efi}<br>for Microsoft bootloader. This allows unusual boot paths to be automaticlly<br>discovered by the boot picker. Designwise they are equivalent to predefined blessed path, such as<br>\texttt{\textbackslash System\textbackslash Library\textbackslash CoreServices\textbackslash boot.efi},<br>but unlike predefined bless paths they have highest priority.</p>
</li>
<li><p>\texttt{Debug}\<br>\textbf{Type}: \texttt{plist\ dict}\<br>\textbf{Description}: Apply debug configuration described in<br>\hyperref[miscdebugprops]{Debug Properties} section below.</p>
</li>
<li><p>\texttt{Entries}\<br>\textbf{Type}: \texttt{plist\ array}\<br>\textbf{Description}: Add boot entries to boot picker.</p>
<p>Designed to be filled with \texttt{plist\ dict} values, describing each load entry.<br>See \hyperref[miscentryprops]{Entry Properties} section below.</p>
</li>
<li><p>\texttt{Security}\<br>\textbf{Type}: \texttt{plist\ dict}\<br>\textbf{Description}: Apply security configuration described in<br>\hyperref[miscsecurityprops]{Security Properties} section below.</p>
</li>
<li><p>\texttt{Tools}\<br>\textbf{Type}: \texttt{plist\ array}\<br>\textbf{Description}: Add tool entries to boot picker.</p>
<p>Designed to be filled with \texttt{plist\ dict} values, describing each load entry.<br>See \hyperref[miscentryprops]{Entry Properties} section below.</p>
<p>\emph{Note}: Select tools, for example,<br><a href="https://github.com/acidanthera/OpenCoreShell" target="_blank" rel="noopener">UEFI Shell</a> are very<br>dangerous and \textbf{MUST NOT} appear in production configurations, especially<br>in vaulted ones and protected with secure boot, as they may be used to easily<br>bypass secure boot chain.</p>
</li>
</ul>
<p>\end{enumerate}</p>
<p>\subsection{Boot Properties}\label{miscbootprops}</p>
<p>\begin{enumerate}</p>
<ul>
<li><p>\texttt{HibernateMode}\<br>\textbf{Type}: \texttt{plist\ string}\<br>\textbf{Failsafe}: \texttt{None}\<br>\textbf{Description}: Hibernation detection mode. The following modes are supported:</p>
<p>\begin{itemize}<br>\tightlist<br>\item \texttt{None} — Avoid hibernation for your own good.<br>\item \texttt{Auto} — Use RTC and NVRAM detection.<br>\item \texttt{RTC} — Use RTC detection.<br>\item \texttt{NVRAM} — Use NVRAM detection.<br>\end{itemize}</p>
</li>
<li><p>\texttt{HideSelf}\<br>\textbf{Type}: \texttt{plist\ boolean}\<br>\textbf{Failsafe}: \texttt{false}\<br>\textbf{Description}: Hides own boot entry from boot picker. This<br>may potentially hide other entries, for instance, when another UEFI OS is<br>installed on the same volume and driver boot is used.</p>
</li>
<li><p>\texttt{PickerAttributes}\<br>\textbf{Type}: \texttt{plist\ integer}\<br>\textbf{Failsafe}: \texttt{0}\<br>\textbf{Description}: Sets specific attributes for picker.</p>
<p>Builtin picker supports colour arguments as a sum of foreground and background<br>colors according to UEFI specification. The value of black background and<br>black foreground (\texttt{0}) is reserved. List of colour names:</p>
<p>\begin{itemize}<br>\tightlist<br>\item \texttt{0x00} — \texttt{EFI_BLACK}<br>\item \texttt{0x01} — \texttt{EFI_BLUE}<br>\item \texttt{0x02} — \texttt{EFI_GREEN}<br>\item \texttt{0x03} — \texttt{EFI_CYAN}<br>\item \texttt{0x04} — \texttt{EFI_RED}<br>\item \texttt{0x05} — \texttt{EFI_MAGENTA}<br>\item \texttt{0x06} — \texttt{EFI_BROWN}<br>\item \texttt{0x07} — \texttt{EFI_LIGHTGRAY}<br>\item \texttt{0x08} — \texttt{EFI_DARKGRAY}<br>\item \texttt{0x09} — \texttt{EFI_LIGHTBLUE}<br>\item \texttt{0x0A} — \texttt{EFI_LIGHTGREEN}<br>\item \texttt{0x0B} — \texttt{EFI_LIGHTCYAN}<br>\item \texttt{0x0C} — \texttt{EFI_LIGHTRED}<br>\item \texttt{0x0D} — \texttt{EFI_LIGHTMAGENTA}<br>\item \texttt{0x0E} — \texttt{EFI_YELLOW}<br>\item \texttt{0x0F} — \texttt{EFI_WHITE}<br>\item \texttt{0x00} — \texttt{EFI_BACKGROUND_BLACK}<br>\item \texttt{0x10} — \texttt{EFI_BACKGROUND_BLUE}<br>\item \texttt{0x20} — \texttt{EFI_BACKGROUND_GREEN}<br>\item \texttt{0x30} — \texttt{EFI_BACKGROUND_CYAN}<br>\item \texttt{0x40} — \texttt{EFI_BACKGROUND_RED}<br>\item \texttt{0x50} — \texttt{EFI_BACKGROUND_MAGENTA}<br>\item \texttt{0x60} — \texttt{EFI_BACKGROUND_BROWN}<br>\item \texttt{0x70} — \texttt{EFI_BACKGROUND_LIGHTGRAY}<br>\end{itemize}</p>
<p>\emph{Note}: This option may not work well with \texttt{System} text renderer.<br>Setting a background different from black could help testing proper GOP functioning.</p>
</li>
<li><p>\texttt{PollAppleHotKeys}\<br>\textbf{Type}: \texttt{plist\ boolean}\<br>\textbf{Failsafe}: \texttt{false}\<br>\textbf{Description}: Enable \texttt{modifier hotkey} handling in boot picker.</p>
<p>In addition to \texttt{action hotkeys}, which are partially described in \texttt{PickerMode}<br>section and are normally handled by Apple BDS, there exist modifier keys, which are<br>handled by operating system bootloader, namely \texttt{boot.efi}. These keys<br>allow to change operating system behaviour by providing different boot modes.</p>
<p>On some firmwares it may be problematic to use modifier keys due to driver incompatibilities.<br>To workaround this problem this option allows registering select hotkeys in a more<br>permissive manner from within boot picker. Such extensions include the support<br>of tapping on keys in addition to holding and pressing \texttt{Shift} along with<br>other keys instead of just \texttt{Shift} alone, which is not detectible on many<br>PS/2 keyboards. This list of known \texttt{modifier hotkeys} includes:<br>\begin{itemize}<br>\tightlist<br>\item \texttt{CMD+C+MINUS} — disable board compatibility checking.<br>\item \texttt{CMD+K} — boot release kernel, similar to \texttt{kcsuffix=release}.<br>\item \texttt{CMD+S} — single user mode.<br>\item \texttt{CMD+S+MINUS} — disable KASLR slide, requires disabled SIP.<br>\item \texttt{CMD+V} — verbose mode.<br>\item \texttt{Shift} — safe mode.<br>\end{itemize}</p>
</li>
<li><p>\texttt{ShowPicker}\<br>\textbf{Type}: \texttt{plist\ boolean}\<br>\textbf{Failsafe}: \texttt{false}\<br>\textbf{Description}: Show simple boot picker to allow boot entry selection.</p>
</li>
<li><p>\texttt{TakeoffDelay}\<br>\textbf{Type}: \texttt{plist\ integer}, 32 bit\<br>\textbf{Failsafe}: \texttt{0}\<br>\textbf{Description}: Delay in microseconds performed before handling<br>picker startup and \texttt{action hotkeys}.</p>
<p>Introducing a delay may give extra time to hold the right \texttt{action hotkey}<br>sequence to e.g. boot to recovery mode. On some platforms setting this option to<br>at least \texttt{5000-10000} microseconds may be necessary to access<br>\texttt{action hotkeys} at all due to the nature of the keyboard driver.</p>
</li>
<li><p>\texttt{Timeout}\<br>\textbf{Type}: \texttt{plist\ integer}, 32 bit\<br>\textbf{Failsafe}: \texttt{0}\<br>\textbf{Description}: Timeout in seconds in boot picker before<br>automatic booting of the default boot entry. Use 0 to disable timer.</p>
</li>
<li><p>\texttt{PickerMode}\<br>\textbf{Type}: \texttt{plist\ string}\<br>\textbf{Failsafe}: \texttt{Builtin}\<br>\textbf{Description}: Choose boot picker used for boot management.</p>
<p>Picker describes underlying boot management with an optional user interface<br>responsible for handling boot options. The following values are supported:</p>
<p>\begin{itemize}<br>\tightlist<br>\item \texttt{Builtin} — boot management is handled by OpenCore, a simple<br>text only user interface is used.<br>\item \texttt{External} — an external boot management protocol is used<br>if available. Otherwise \texttt{Builtin} mode is used.<br>\item \texttt{Apple} — Apple boot management is used if available.<br>Otherwise \texttt{Builtin} mode is used.<br>\end{itemize}</p>
</li>
</ul>
<p>  Upon success \texttt{External} mode will entirely disable all boot management<br>  in OpenCore except policy enforcement. In \texttt{Apple} mode it may additionally<br>  bypass policy enforcement. To implement \texttt{External} mode a custom user interface may<br>  utilise <a href="https://github.com/acidanthera/OcSupportPkg" target="_blank" rel="noopener">OcSupportPkg</a><br>  \texttt{OcBootManagementLib}. Reference example of external graphics interface is provided in<br>  <a href="https://github.com/acidanthera/OcSupportPkg/tree/master/Tests/ExternalUi" target="_blank" rel="noopener">ExternalUi</a><br>  test driver.</p>
<p>  OpenCore built-in boot picker contains a set of actions chosen during the boot process.<br>  The list of supported actions is similar to Apple BDS and in general can be accessed by<br>  holding \texttt{action hotkeys} during boot process. Currently the following actions are<br>  considered:</p>
<p>  \begin{itemize}<br>  \tightlist<br>  \item \texttt{Default} — this is the default option, and it lets OpenCore built-in<br>  boot picker to loads the default boot option as specified in<br>  <a href="https://support.apple.com/HT202796" target="_blank" rel="noopener">Startup Disk</a> preference pane.<br>  \item \texttt{ShowPicker} — this option forces picker to show. Normally it can be<br>  achieved by holding \texttt{OPT} key during boot. Setting \texttt{ShowPicker} to<br>  \texttt{true} will make \texttt{ShowPicker} the default option.<br>  \item \texttt{ResetNvram} — this option performs select UEFI variable erase and is<br>  normally achieved by holding \texttt{CMD+OPT+P+R} key combination during boot.<br>  Another way to erase UEFI variables is to choose \texttt{Reset NVRAM} in the picker.<br>  This option requires \texttt{AllowNvramReset} to be set to \texttt{true}.<br>  \item \texttt{BootApple} — this options performs booting to the first found Apple<br>  operating system unless the default chosen operating system is already made by Apple.<br>  Hold \texttt{X} key to choose this option.<br>  \item \texttt{BootAppleRecovery} — this option performs booting to Apple operating<br>  system recovery. Either the one related to the default chosen operating system,<br>  or first found in case default chosen operating system is not made by Apple or has no<br>  recovery. Hold \texttt{CMD+R} key combination to choose this option.<br>  \end{itemize}</p>
<p>  \emph{Note 1}: Activated \texttt{KeySupport}, \texttt{AppleUsbKbDxe}, or similar driver is required<br>  for key handling to work. On many firmwares it is not possible to get all the keys function.</p>
<p>  \emph{Note 2}: In addition to \texttt{OPT} OpenCore supports \texttt{Escape} key to display picker when<br>  \texttt{ShowPicker} is disabled. This key exists for \texttt{Apple} picker mode and for<br>  firmwares with PS/2 keyboards that fail to report held \texttt{OPT} key and require continual<br>  presses of \texttt{Escape} key to enter the boot menu.</p>
<p>  \emph{Note 3}: On Macs with problematic GOP it may be difficult to access Apple BootPicker.<br>  To workaround this problem even without loading OpenCore \texttt{BootKicker} utility can be blessed.</p>
<p>\end{enumerate}</p>
<p>\subsection{Debug Properties}\label{miscdebugprops}</p>
<p>\begin{enumerate}</p>
<ul>
<li><p>\texttt{DisableWatchDog}\<br>\textbf{Type}: \texttt{plist\ boolean}\<br>\textbf{Failsafe}: \texttt{false}\<br>\textbf{Description}: Select firmwares may not succeed in quickly booting<br>the operating system, especially in debug mode, which results in watch dog<br>timer aborting the process. This option turns off watch dog timer.</p>
</li>
<li><p>\texttt{DisplayDelay}\<br>\textbf{Type}: \texttt{plist\ integer}\<br>\textbf{Failsafe}: \texttt{0}\<br>\textbf{Description}: Delay in microseconds performed after<br>every printed line visible onscreen (i.e. console).</p>
</li>
<li><p>\texttt{DisplayLevel}\<br>\textbf{Type}: \texttt{plist\ integer}, 64 bit\<br>\textbf{Failsafe}: \texttt{0}\<br>\textbf{Description}: EDK II debug level bitmask (sum) showed onscreen.<br>Unless \texttt{Target} enables console (onscreen) printing,<br>onscreen debug output will not be visible. The following levels<br>are supported (discover more in<br><a href="https://github.com/tianocore/edk2/blob/UDK2018/MdePkg/Include/Library/DebugLib.h" target="_blank" rel="noopener">DebugLib.h</a>):</p>
<p>\begin{itemize}<br>\tightlist<br>\item \texttt{0x00000002} (bit \texttt{1}) — \texttt{DEBUG_WARN} in \texttt{DEBUG},<br> \texttt{NOOPT}, \texttt{RELEASE}.<br>\item \texttt{0x00000040} (bit \texttt{6}) — \texttt{DEBUG_INFO} in \texttt{DEBUG},<br> \texttt{NOOPT}.<br>\item \texttt{0x00400000} (bit \texttt{22}) — \texttt{DEBUG_VERBOSE} in custom builds.<br>\item \texttt{0x80000000} (bit \texttt{31}) — \texttt{DEBUG_ERROR} in \texttt{DEBUG},<br> \texttt{NOOPT}, \texttt{RELEASE}.<br>\end{itemize}</p>
</li>
<li><p>\texttt{Target}\<br>\textbf{Type}: \texttt{plist\ integer}\<br>\textbf{Failsafe}: \texttt{0}\<br>\textbf{Description}: A bitmask (sum) of enabled logging targets.<br>By default all the logging output is hidden, so this option is<br>required to be set when debugging is necessary.</p>
<p>The following logging targets are supported:</p>
<p>\begin{itemize}<br>\tightlist<br>\item \texttt{0x01} (bit \texttt{0}) — Enable logging, otherwise all log is discarded.<br>\item \texttt{0x02} (bit \texttt{1}) — Enable basic console (onscreen) logging.<br>\item \texttt{0x04} (bit \texttt{2}) — Enable logging to Data Hub.<br>\item \texttt{0x08} (bit \texttt{3}) — Enable serial port logging.<br>\item \texttt{0x10} (bit \texttt{4}) — Enable UEFI variable logging.<br>\item \texttt{0x20} (bit \texttt{5}) — Enable non-volatile UEFI variable logging.<br>\item \texttt{0x40} (bit \texttt{6}) — Enable logging to file.<br>\end{itemize}</p>
<p>Console logging prints less than all the other variants.<br>Depending on the build type (\texttt{RELEASE}, \texttt{DEBUG}, or<br>\texttt{NOOPT}) different amount of logging may be read (from least to most).</p>
<p>Data Hub log will not log kernel and kext patches. To obtain Data Hub log use<br>the following command in macOS:<br>\begin{lstlisting}[label=dhublog, style=ocbash]<br>ioreg -lw0 -p IODeviceTree | grep boot-log | sort | sed ‘s/.*&lt;(.<em>)&gt;.</em>/\1/‘ | xxd -r -p<br>\end{lstlisting}</p>
<p>UEFI variable log does not include some messages and has no performance data. For safety<br>reasons log size is limited to 32 kilobytes. Some firmwares may truncate it much earlier<br>or drop completely if they have no memory. Using non-volatile flag will write the log to<br>NVRAM flash after every printed line. To obtain UEFI variable log use the following command<br>in macOS:<br>\begin{lstlisting}[label=nvramlog, style=ocbash]<br>nvram 4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:boot-log |<br>awk ‘{gsub(/%0d%0a%00/,””);gsub(/%0d%0a/,”\n”)}1’<br>\end{lstlisting}</p>
<p>\emph{Warning}: Some firmwares are reported to have broken NVRAM garbage collection.<br>This means that they may not be able to always free space after variable deletion.<br>Do not use non-volatile NVRAM logging without extra need on such devices.</p>
<p>While OpenCore boot log already contains basic version information with build type and<br>date, this data may also be found in NVRAM in \texttt{opencore-version} variable<br>even with boot log disabled.</p>
<p>File logging will create a file named \texttt{opencore-YYYY-MM-DD-HHMMSS.txt} at EFI<br>volume root with log contents (the upper case letter sequence is replaced with date<br>and time from the firmware). Please be warned that some file system drivers present<br>in firmwares are not reliable, and may corrupt data when writing files through UEFI.<br>Log is attempted to be written in the safest manner, and thus is very slow. Ensure that<br>\texttt{DisableWatchDog} is set to \texttt{true} when you use a slow drive.</p>
</li>
</ul>
<p>\end{enumerate}</p>
<p>\subsection{Security Properties}\label{miscsecurityprops}</p>
<p>\begin{enumerate}</p>
<ul>
<li><p>\texttt{AllowNvramReset}\<br>\textbf{Type}: \texttt{plist\ boolean}\<br>\textbf{Failsafe}: \texttt{false}\<br>\textbf{Description}: Allow \texttt{CMD+OPT+P+R} handling and enable<br>showing \texttt{NVRAM Reset} entry in boot picker.</p>
</li>
<li><p>\texttt{AllowSetDefault}\<br>\textbf{Type}: \texttt{plist\ boolean}\<br>\textbf{Failsafe}: \texttt{false}\<br>\textbf{Description}: Allow \texttt{CTRL+Enter} and \texttt{CTRL+Index} handling<br>to set the default boot option in boot picker.</p>
</li>
<li><p>\texttt{AuthRestart}\<br>\textbf{Type}: \texttt{plist\ boolean}\<br>\textbf{Failsafe}: \texttt{false}\<br>\textbf{Description}: Enable \texttt{VirtualSMC}-compatible authenticated restart.</p>
<p>Authenticated restart is a way to reboot FileVault 2 enabled macOS without entering<br>the password. To perform authenticated restart one can use a dedicated terminal<br>command: \texttt{sudo fdesetup authrestart}. It is also used when installing<br>operating system updates.</p>
<p>VirtualSMC performs authenticated restart by saving disk encryption key split in<br>NVRAM and RTC, which despite being removed as soon as OpenCore starts, may be<br>considered a security risk and thus is optional.</p>
</li>
<li><p>\texttt{ExposeSensitiveData}\<br>\textbf{Type}: \texttt{plist\ integer}\<br>\textbf{Failsafe}: \texttt{0x6}\<br>\textbf{Description}: Sensitive data exposure bitmask (sum) to operating system.</p>
<p>\begin{itemize}<br>\tightlist<br>\item \texttt{0x01} — Expose printable booter path as an UEFI variable.<br>\item \texttt{0x02} — Expose OpenCore version as an UEFI variable.<br>\item \texttt{0x04} — Expose OpenCore version in boot picker menu title.<br>\item \texttt{0x08} — Expose OEM information as a set of UEFI variables.<br>\end{itemize}</p>
<p>Exposed booter path points to OpenCore.efi or its booter depending on the load order.<br>To obtain booter path use the following command in macOS:<br>\begin{lstlisting}[label=nvrampath, style=ocbash]<br>nvram 4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:boot-path<br>\end{lstlisting}</p>
<p>To use booter path for mounting booter volume use the following command in macOS:<br>\begin{lstlisting}[label=nvrampathmount, style=ocbash]<br>u=$(nvram 4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:boot-path | sed ‘s/.<em>GPT,([^,]*),.</em>/\1/‘); <br>if [ “$u” != “” ]; then sudo diskutil mount $u ; fi<br>\end{lstlisting}</p>
<p>To obtain OpenCore version use the following command in macOS:<br>\begin{lstlisting}[label=nvramver, style=ocbash]<br>nvram 4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:opencore-version<br>\end{lstlisting}</p>
<p>To obtain OEM information use the following commands in macOS:<br>\begin{lstlisting}[label=nvramver, style=ocbash]<br>nvram 4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:oem-product # SMBIOS Type1 ProductName<br>nvram 4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:oem-vendor  # SMBIOS Type2 Manufacturer<br>nvram 4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:oem-board   # SMBIOS Type2 ProductName<br>\end{lstlisting}</p>
</li>
<li><p>\texttt{HaltLevel}\<br>\textbf{Type}: \texttt{plist\ integer}, 64 bit\<br>\textbf{Failsafe}: \texttt{0x80000000} (\texttt{DEBUG_ERROR})\<br>\textbf{Description}: EDK II debug level bitmask (sum) causing CPU to<br>halt (stop execution) after obtaining a message of \texttt{HaltLevel}.<br>Possible values match \texttt{DisplayLevel} values.</p>
</li>
<li><p>\texttt{Vault}\<br>\textbf{Type}: \texttt{plist\ string}\<br>\textbf{Failsafe}: \texttt{Secure}\<br>\textbf{Description}: Enables vaulting mechanism in OpenCore.</p>
<p>Valid values:</p>
<p>\begin{itemize}<br>\tightlist<br>\item \texttt{Optional} — require nothing, no vault is enforced, insecure.<br>\item \texttt{Basic} — require \texttt{vault.plist} file present<br>in \texttt{OC} directory. This provides basic filesystem integrity<br>verification and may protect from unintentional filesystem corruption.<br>\item \texttt{Secure} — require \texttt{vault.sig} signature file for<br>\texttt{vault.plist} in \texttt{OC} directory. This includes \texttt{Basic}<br>integrity checking but also attempts to build a trusted bootchain.<br>\end{itemize}</p>
<p>\texttt{vault.plist} file should contain SHA-256 hashes for all files used by OpenCore.<br>Presence of this file is highly recommended to ensure that unintentional<br>file modifications (including filesystem corruption) do not happen unnoticed.<br>To create this file automatically use<br><a href="https://github.com/acidanthera/OcSupportPkg/tree/master/Utilities/CreateVault" target="_blank" rel="noopener">\texttt{create_vault.sh</a>} script.<br>Regardless of the underlying filesystem, path name and case must match<br>between \texttt{config.plist} and \texttt{vault.plist}.</p>
<p>\texttt{vault.sig} file should contain a raw 256 byte RSA-2048 signature from SHA-256<br>hash of \texttt{vault.plist}. The signature is verified against the public<br>key embedded into \texttt{OpenCore.efi}. To embed the public key you should<br>do either of the following:</p>
<p>\begin{itemize}<br>\tightlist<br>\item Provide public key during the \texttt{OpenCore.efi} compilation in<br><a href="https://github.com/acidanthera/OpenCorePkg/blob/master/Platform/OpenCore/OpenCoreVault.c" target="_blank" rel="noopener">\texttt{OpenCoreVault.c</a>} file.<br>\item Binary patch \texttt{OpenCore.efi} replacing zeroes with the public key<br>between \texttt{=BEGIN OC VAULT=} and \texttt{==END OC VAULT==} ASCII markers.<br>\end{itemize}</p>
<p>RSA public key 520 byte format description can be found in Chromium OS documentation.<br>To convert public key from X.509 certificate or from PEM file use<br><a href="https://github.com/acidanthera/OcSupportPkg/tree/master/Utilities/CreateVault" target="_blank" rel="noopener">RsaTool</a>.</p>
</li>
</ul>
<p>  The complete set of commands to:</p>
<p>  \begin{itemize}<br>  \tightlist<br>  \item Create \texttt{vault.plist}.<br>  \item Create a new RSA key (always do this to avoid loading old configuration).<br>  \item Embed RSA key into \texttt{OpenCore.efi}.<br>  \item Create \texttt{vault.sig}.<br>  \end{itemize}</p>
<p>  Can look as follows:<br>\begin{lstlisting}[label=createvault, style=ocbash]<br>cd /Volumes/EFI/EFI/OC<br>/path/to/create_vault.sh .<br>/path/to/RsaTool -sign vault.plist vault.sig vault.pub<br>off=$(($(strings -a -t d OpenCore.efi | grep “=BEGIN OC VAULT=” | cut -f1 -d’ ‘)+16))<br>dd of=OpenCore.efi if=vault.pub bs=1 seek=$off count=528 conv=notrunc<br>rm vault.pub<br>\end{lstlisting}</p>
<p>  \emph{Note 1}: While it may appear obvious, but you have to use an external<br>  method to verify \texttt{OpenCore.efi} and \texttt{BOOTx64.efi} for<br>  secure boot path. For this you are recommended to at least enable UEFI SecureBoot<br>  with a custom certificate, and sign \texttt{OpenCore.efi} and \texttt{BOOTx64.efi}<br>  with your custom key. More details on customising secure boot on modern firmwares<br>  can be found in <a href="https://habr.com/post/273497/" target="_blank" rel="noopener">Taming UEFI SecureBoot</a><br>  paper (in Russian).</p>
<p>  \emph{Note 2}: \texttt{vault.plist} and \texttt{vault.sig} are used regardless of this<br>  option when \texttt{vault.plist} is present or public key is embedded into<br>  \texttt{OpenCore.efi}. Setting this option will only ensure configuration sanity,<br>  and abort the boot process otherwise.</p>
<ul>
<li><p>\texttt{ScanPolicy}\<br>\textbf{Type}: \texttt{plist\ integer}, 32 bit\<br>\textbf{Failsafe}: \texttt{0xF0103}\<br>\textbf{Description}: Define operating system detection policy.</p>
<p>This value allows to prevent scanning (and booting) from untrusted<br>source based on a bitmask (sum) of select flags. As it is not possible<br>to reliably detect every file system or device type, this feature<br>cannot be fully relied upon in open environments, and the additional<br>measures are to be applied.</p>
<p>Third party drivers may introduce additional security (and performance)<br>measures following the provided scan policy. Scan policy is exposed<br>in \texttt{scan-policy} variable of \texttt{4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102}<br>GUID for UEFI Boot Services only.</p>
<p>\begin{itemize}<br>\tightlist<br>\item \texttt{0x00000001} (bit \texttt{0}) — \texttt{OC_SCAN_FILE_SYSTEM_LOCK}, restricts<br>scanning to only known file systems defined as a part of this policy. File system<br>drivers may not be aware of this policy, and to avoid mounting of undesired file<br>systems it is best not to load its driver. This bit does not affect dmg mounting,<br>which may have any file system. Known file systems are prefixed with<br>\texttt{OC_SCAN_ALLOW_FS_}.<br>\item \texttt{0x00000002} (bit \texttt{1}) — \texttt{OC_SCAN_DEVICE_LOCK}, restricts scanning<br>to only known device types defined as a part of this policy. This is not always possible<br>to detect protocol tunneling, so be aware that on some systems it may be possible for<br>e.g. USB HDDs to be recognised as SATA. Cases like this must be reported. Known device<br>types are prefixed with \texttt{OC_SCAN_ALLOW_DEVICE_}.<br>\item \texttt{0x00000100} (bit \texttt{8}) — \texttt{OC_SCAN_ALLOW_FS_APFS}, allows scanning<br>of APFS file system.<br>\item \texttt{0x00000200} (bit \texttt{9}) — \texttt{OC_SCAN_ALLOW_FS_HFS}, allows scanning<br>of HFS file system.<br>\item \texttt{0x00000400} (bit \texttt{10}) — \texttt{OC_SCAN_ALLOW_FS_ESP}, allows scanning<br>of EFI System Partition file system.<br>\item \texttt{0x00000800} (bit \texttt{11}) — \texttt{OC_SCAN_ALLOW_FS_NTFS}, allows scanning<br>of NTFS (Msft Basic Data) file system.<br>\item \texttt{0x00001000} (bit \texttt{12}) — \texttt{OC_SCAN_ALLOW_FS_EXT}, allows scanning<br>of EXT (Linux Root) file system.<br>\item \texttt{0x00010000} (bit \texttt{16}) — \texttt{OC_SCAN_ALLOW_DEVICE_SATA}, allow<br>scanning SATA devices.<br>\item \texttt{0x00020000} (bit \texttt{17}) — \texttt{OC_SCAN_ALLOW_DEVICE_SASEX}, allow<br>scanning SAS and Mac NVMe devices.<br>\item \texttt{0x00040000} (bit \texttt{18}) — \texttt{OC_SCAN_ALLOW_DEVICE_SCSI}, allow<br>scanning SCSI devices.<br>\item \texttt{0x00080000} (bit \texttt{19}) — \texttt{OC_SCAN_ALLOW_DEVICE_NVME}, allow<br>scanning NVMe devices.<br>\item \texttt{0x00100000} (bit \texttt{20}) — \texttt{OC_SCAN_ALLOW_DEVICE_ATAPI}, allow<br>scanning CD/DVD devices.<br>\item \texttt{0x00200000} (bit \texttt{21}) — \texttt{OC_SCAN_ALLOW_DEVICE_USB}, allow<br>scanning USB devices.<br>\item \texttt{0x00400000} (bit \texttt{22}) — \texttt{OC_SCAN_ALLOW_DEVICE_FIREWIRE}, allow<br>scanning FireWire devices.<br>\item \texttt{0x00800000} (bit \texttt{23}) — \texttt{OC_SCAN_ALLOW_DEVICE_SDCARD}, allow<br>scanning card reader devices.<br>\end{itemize}</p>
<p>\emph{Note}: Given the above description, \texttt{0xF0103} value is expected to allow<br>scanning of SATA, SAS, SCSI, and NVMe devices with APFS file system, and prevent scanning<br>of any devices with HFS or FAT32 file systems in addition to not scanning APFS file systems<br>on USB, CD, and FireWire drives. The combination reads as:<br>\begin{itemize}<br>\tightlist<br>\item \texttt{OC_SCAN_FILE_SYSTEM_LOCK}<br>\item \texttt{OC_SCAN_DEVICE_LOCK}<br>\item \texttt{OC_SCAN_ALLOW_FS_APFS}<br>\item \texttt{OC_SCAN_ALLOW_DEVICE_SATA}<br>\item \texttt{OC_SCAN_ALLOW_DEVICE_SASEX}<br>\item \texttt{OC_SCAN_ALLOW_DEVICE_SCSI}<br>\item \texttt{OC_SCAN_ALLOW_DEVICE_NVME}<br>\end{itemize}</p>
</li>
</ul>
<p>\end{enumerate}</p>
<p>\subsection{Entry Properties}\label{miscentryprops}</p>
<p>\begin{enumerate}</p>
<ul>
<li><p>\texttt{Arguments}\<br>\textbf{Type}: \texttt{plist\ string}\<br>\textbf{Failsafe}: Empty string\<br>\textbf{Description}: Arbitrary ASCII string used as boot arguments (load options)<br>of the specified entry.</p>
</li>
<li><p>\texttt{Comment}\<br>\textbf{Type}: \texttt{plist\ string}\<br>\textbf{Failsafe}: Empty string\<br>\textbf{Description}: Arbitrary ASCII string used to provide human readable<br>reference for the entry. It is implementation defined whether this value is<br>used.</p>
</li>
<li><p>\texttt{Enabled}\<br>\textbf{Type}: \texttt{plist\ boolean}\<br>\textbf{Failsafe}: \texttt{false}\<br>\textbf{Description}: This entry will not be listed unless set to<br>\texttt{true}.</p>
</li>
<li><p>\texttt{Name}\<br>\textbf{Type}: \texttt{plist\ string}\<br>\textbf{Failsafe}: Empty string\<br>\textbf{Description}: Human readable entry name displayed in boot picker.</p>
</li>
<li><p>\texttt{Path}\<br>\textbf{Type}: \texttt{plist\ string}\<br>\textbf{Failsafe}: Empty string\<br>\textbf{Description}: Entry location depending on entry type.</p>
<p>\begin{itemize}<br>\tightlist<br>\item \texttt{Entries} specify external boot options, and therefore take device<br>paths in \texttt{Path} key. These values are not checked, thus be extremely careful.<br>Example: \texttt{PciRoot(0x0)/Pci(0x1,0x1)/…/\textbackslash EFI\textbackslash COOL.EFI}<br>\item \texttt{Tools} specify internal boot options, which are part of bootloader<br>vault, and therefore take file paths relative to \texttt{OC/Tools} directory.<br>Example: \texttt{Shell.efi}.<br>\end{itemize}</p>
</li>
</ul>
<p>\end{enumerate}</p>

            </div>

            <ul class="doku-pagination">
            <li class="page-item page-prev">
                <a href="/7-kernel.html">
                    <div class="page-item-subtitle"><span class="icon is-small"><i class="fas fa-arrow-left"></i></span> <span>前一页</span></div>
                    <div class="page-item-title h5">7. Kernel</div>
                </a>
            </li>
            <li class="page-item page-next">
                <a href="/9-nvram.html">
                    <div class="page-item-subtitle"><span>后一页</span> <span class="icon is-small"><i class="fas fa-arrow-right"></i></span></div>
                    <div class="page-item-title h5">9. NVRAM</div>
                </a>
            </li></ul>
        </div>
        
    </div>
</article>

                <footer>
    <div class="doku-footer-container is-clearfix">
        <div class="doku-footer-item is-pulled-left">&copy; <span id="doku-copyrght-year"></span> <a href="/">OpenCore 简体中文参考手册(非官方)</a></div>

        <div class="doku-footer-item is-pulled-right">Powered by <a href="https://hexo.io" target="_blank" rel="external noopenner nofollow">Hexo</a> & <a href="https://github.com/SukkaW/hexo-theme-doku" target="_blank" rel="external noopenner nofollow">Doku</a></div>
    </div>
</footer>

            </main>
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/stickyfilljs@2.1.0/dist/stickyfill.min.js"></script>
    <script src="/theme-doku/js/doku.js"></script>
</body>

</html>
